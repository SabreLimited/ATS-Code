/** @license Copyright (c) Microsoft Corporation. All rights reserved. */
var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var CalendarDataSetPropertyNames=function(){function CalendarDataSetPropertyNames(){}Object.defineProperty(CalendarDataSetPropertyNames,"DescriptionName",{"get":function(){return "Description"},enumerable:true,configurable:true});Object.defineProperty(CalendarDataSetPropertyNames,"ColorName",{"get":function(){return "Color"},enumerable:true,configurable:true});return CalendarDataSetPropertyNames}();Calendar.CalendarDataSetPropertyNames=CalendarDataSetPropertyNames})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var DhtmlxProxy=function(){function DhtmlxProxy(schedulerControl,schedulerStaticConfig,containerId,configuration,eventManager,locale,formatterProvider,iconProvider,timeZoneConverter){this.isRendered=false;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(schedulerControl))throw new Error("Missing argument : schedulerControl");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(containerId))throw new Error("Missing argument : containerId");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(configuration))throw new Error("Missing argument : configuration");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(eventManager))throw new Error("Missing argument : eventManager");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(locale))throw new Error("Missing argument : locale");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(schedulerStaticConfig))throw new Error("Missing argument : schedulerStaticConfig");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(formatterProvider))throw new Error("Missing argument : formatterProvider");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(iconProvider))throw new Error("Missing argument : iconProvider");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(timeZoneConverter))throw new Error("Missing argument : timeZoneConverter");this.schedulerControl=schedulerControl;this.containerId=containerId;this.configuration=configuration;this.eventManager=eventManager;this.locale=locale;this.schedulerStaticConfig=schedulerStaticConfig;this.formatterProvider=formatterProvider;this.timeZoneConverter=timeZoneConverter;this.instanceId=MscrmCommon.ControlUtils.ControlGuidGenerator.newGuid("CalendarControl-DhtmlxProxy");DhtmlxProxy.theme=configuration.theme;DhtmlxProxy.iconProvider=iconProvider;DhtmlxProxy.getEntityColor=configuration.getEntityColor;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(DhtmlxProxy.instances))DhtmlxProxy.instances={};DhtmlxProxy.instances[this.instanceId]=true}DhtmlxProxy.prototype.initialize=function(){this.configureProxy();this.initializeProxy()};DhtmlxProxy.prototype.configureProxy=function(){this.setLocale();this.setupDateRangeChangeHandler();this.setupOnClickHandler();this.configure()};DhtmlxProxy.prototype.initializeProxy=function(){this.schedulerControl.init(this.containerId,this.configuration.selectedDate,this.configuration.selectedView);this.triggerOnDateRangeChanged()};DhtmlxProxy.prototype.getState=function(){var state=new Calendar.CalendarState;state.selectedDate=this.schedulerControl.getState().date;state.selectedView=this.schedulerControl.getState().mode;return state};DhtmlxProxy.prototype.destroy=function(){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.schedulerControl)){this.schedulerControl.detachAllEvents();this.schedulerControl.clearAll();for(var fieldIndex in this.schedulerControl)if(typeof this.schedulerControl[fieldIndex]==="function")this.schedulerControl[fieldIndex]=function(){};else this.schedulerControl[fieldIndex]=null;this.schedulerControl.callEvent=function(){return false}}!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.eventManager)&&this.eventManager.removeAllHandlers();!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.locale)&&this.locale.destroy();!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.configuration)&&this.configuration.destroy();this.containerId=null;this.eventManager=null;this.locale=null;this.schedulerControl=null;this.schedulerStaticConfig=null;this.configuration=null;this.formatterProvider=null;delete DhtmlxProxy.instances[this.instanceId];if($.isEmptyObject(DhtmlxProxy.instances)){DhtmlxProxy.theme=null;DhtmlxProxy.iconProvider=null;DhtmlxProxy.getEntityColor=null}};DhtmlxProxy.prototype.showCalendarItems=function(calendarItems){if(calendarItems.length!==0)this.schedulerControl.parse(calendarItems,"json");else this.schedulerControl.clearAll();this.isRendered=true};DhtmlxProxy.prototype.onActivationChanged=function(isActive){isActive&&this.schedulerControl.updateView()};DhtmlxProxy.prototype.addProxyHandler=function(event,handler,context){this.eventManager.addHandler(event,handler,context)};DhtmlxProxy.prototype.removeProxyHandler=function(event){this.eventManager.removeHandler(event)};DhtmlxProxy.prototype.triggerEvent=function(event,eventDescriptor){this.eventManager.triggerEvent(event,eventDescriptor)};DhtmlxProxy.prototype.setupDateRangeChangeHandler=function(){var _this=this;this.schedulerControl.attachEvent(Calendar.DhtmlxConstants.eventOnViewChange,function(oldMode,oldDate){if(!_this.isRendered)return;_this.triggerOnDateRangeChanged()});this.schedulerControl.attachEvent(Calendar.DhtmlxConstants.eventOnBeforeTodayDisplayed,function(){_this.schedulerControl.setCurrentView(_this.timeZoneConverter.getUserTimeNow());return false})};DhtmlxProxy.prototype.triggerOnDateRangeChanged=function(){this.setTodayDateStyle();this.schedulerControl.clearAll();var schedulerState=this.schedulerControl.getState();this.triggerEvent(Calendar.CalendarControlProxyEvent.OnDateRangeChanged,{newStartDate:schedulerState.min_date,newEndDate:schedulerState.max_date})};DhtmlxProxy.prototype.setupOnClickHandler=function(){var _this=this;this.schedulerControl.attachEvent(Calendar.DhtmlxConstants.eventOnClick,function(id,e){var calendarEvent=_this.schedulerControl.getEvent(id);_this.triggerEvent(Calendar.CalendarControlProxyEvent.OnClick,calendarEvent);return false})};DhtmlxProxy.prototype.setLocale=function(){this.schedulerControl.locale.labels.month_tab=this.locale.monthViewLabel;this.schedulerControl.locale.labels.week_tab=this.locale.weekViewLabel;this.schedulerControl.locale.labels.day_tab=this.locale.dayViewLabel;this.schedulerControl.locale.labels.dhx_cal_today_button=this.locale.todayLabel;this.schedulerControl.locale.date.day_short=this.locale.dayShortLabels;this.schedulerControl.locale.date.day_full=this.locale.dayFullLabels;this.schedulerControl.locale.date.month_full=this.locale.monthFullLabels;this.schedulerControl.locale.date.month_short=this.locale.monthShortLabels;this.schedulerStaticConfig.locale.date.day_short=this.locale.dayShortLabels;this.schedulerStaticConfig.locale.date.day_full=this.locale.dayFullLabels;this.schedulerStaticConfig.locale.date.month_full=this.locale.monthFullLabels;this.schedulerStaticConfig.locale.date.month_short=this.locale.monthShortLabels;DhtmlxProxy.viewMoreLabel=this.locale.viewMoreLabel};DhtmlxProxy.isMultiDayEvent=function(start,end){return start.getDay()!=end.getDay()||start.getMonth()!=end.getMonth()||start.getFullYear()!=end.getFullYear()};DhtmlxProxy.prototype.configure=function(){var _this=this;this.schedulerControl.config.mark_now=false;this.schedulerControl.config.readonly=true;this.schedulerControl.config.drag_move=false;this.schedulerControl.config.touch_tip=false;this.schedulerControl.config.scroll_hour=(new Date).getHours();this.schedulerControl.config.start_on_monday=this.configuration.weekStartsOnMonday;this.schedulerControl.config.fix_tab_position=false;this.schedulerControl.config.separate_short_events=true;this.schedulerControl.config.hour_size_px=74;this.schedulerControl.templates.hour_scale=function(date){var format=_this.schedulerControl.date.date_to_str(_this.formatterProvider.getScaleTimeFormatPattern(_this.configuration));return format(date)};this.schedulerControl.config.hour_date=this.formatterProvider.getTimeFormatPattern(this.configuration);this.schedulerControl.templates.day_date=this.configuration.longDateFormatter;this.schedulerControl.templates.day_scale_date=this.configuration.longDateFormatter;if(this.configuration.showWeekNumbers)this.schedulerControl.templates.week_date=function(startDate,endDate){return _this.getWeekViewTitle(startDate,endDate,_this.formatterProvider.dateSpanFormatterWithWeekNumber(_this.configuration.weekNumberCalculator,_this.configuration.shortDateFormatter))};else this.schedulerControl.templates.week_date=function(startDate,endDate){return _this.getWeekViewTitle(startDate,endDate,_this.formatterProvider.dateSpanFormatter(_this.configuration.shortDateFormatter))};this.schedulerControl.templates.week_scale_date=this.configuration.formatDateLongAbbreviated;this.schedulerControl.templates.month_date=this.configuration.yearMonthDateFormatter;this.schedulerControl.date.date_to_str=this.formatterProvider.dateToStringExtended(this.schedulerControl.date.date_to_str,this.configuration);this.schedulerControl.config.max_month_events=3;this.schedulerControl.renderEvent=function(container,ev){var body=$("<div/>");body.addClass("dhx_body");body.append(DhtmlxProxy.iconProvider.generateThemedIcon(ev,DhtmlxProxy.getEntityColor(ev.logicalName),false));var eventText=$("<div/>");eventText.attr("id","text");eventText.append(_this.schedulerControl.templates.event_text(ev.start_date,ev.end_date,ev));body.append(eventText);container.style.borderColor=DhtmlxProxy.getEntityColor(ev.logicalName);container.innerHTML=$("<div />").append(body).html();return true};this.eventBarDateFormatHandlerId=this.schedulerControl.attachEvent(Calendar.DhtmlxConstants.eventOnTemplatesReady,function(){var schedulerControl=_this.schedulerControl;_this.schedulerControl.templates.event_bar_date=function(start_date,end_date,ev){var icon=MscrmControls.Calendar.DhtmlxProxy.iconProvider.generateThemedIcon(ev,DhtmlxProxy.getEntityColor(ev.logicalName),false),time=$("<div/>");time.addClass("dhx_event_bar_date");time.text(schedulerControl.templates.event_date(start_date));return $("<div />").append(icon,time).html()}});this.schedulerControl.templates.event_bar_text=function(start_date,end_date,ev){if(!MscrmControls.Calendar.DhtmlxProxy.isMultiDayEvent(start_date,end_date))return $("<div />").append(ev.text).html();var icon=MscrmControls.Calendar.DhtmlxProxy.iconProvider.generateThemedIcon(ev,DhtmlxProxy.getEntityColor(ev.logicalName),false),text=$("<span/>");text.addClass("dhx_event_marker_text");text.append(ev.text);return $("<div />").append(icon,text).html()};this.schedulerControl.templates.month_events_link=function(date,count){var link=$("<a />").text(DhtmlxProxy.viewMoreLabel).css("color",DhtmlxProxy.theme.globallinkcolor);return $("<div />").append(link).html()}};DhtmlxProxy.prototype.getWeekViewTitle=function(startDate,endDate,formatter){return formatter(startDate,this.schedulerControl.date.add(endDate,-1,"day"))};DhtmlxProxy.prototype.setTodayDateStyle=function(){$(".dhx_cal_container .dhx_scale_holder_now, .dhx_cal_container .dhx_now .dhx_month_head, .dhx_cal_container .dhx_now .dhx_month_body").css("background-color",DhtmlxProxy.theme.selectedlinkeffect)};return DhtmlxProxy}();Calendar.DhtmlxProxy=DhtmlxProxy})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarDataAdapter=function(){function CalendarDataAdapter(htmlEncode,calendarItemMinDuration,userTimeZoneConverter){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(htmlEncode))throw new Error("Missing argument : htmlEncode");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(userTimeZoneConverter))throw new Error("Missing argument : userTimeZoneConverter");this.htmlEncode=htmlEncode;this.userTimeZoneConverter=userTimeZoneConverter;this.calendarItemMinDuration=calendarItemMinDuration}CalendarDataAdapter.prototype.getCalendarItems=function(calendarDataSet){return this.getCalendarItemsWithTzConversion(calendarDataSet,this.userTimeZoneConverter)};CalendarDataAdapter.prototype.getCalendarItemsWithTzConversion=function(calendarDataSet,timeZoneConverter){var _this=this;return (new MscrmCommon.ArrayQuery(calendarDataSet.sortedRecordIds)).select(function(id){try{var item=calendarDataSet.records[id],calendarItem=new Calendar.CalendarItem(_this.calendarItemMinDuration);calendarItem.id=id;calendarItem.start_date=_this.getDateValueBasedOnDataSetColumnAttributes(calendarDataSet.columns,Calendar.DataSetColumn.StartDate,item.StartDate,timeZoneConverter);if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(item.EndDate))calendarItem.end_date=_this.getDateValueBasedOnDataSetColumnAttributes(calendarDataSet.columns,Calendar.DataSetColumn.EndDate,item.EndDate,timeZoneConverter);else if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(item.Duration))calendarItem.durationInMinutes=item.Duration;calendarItem.text=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(item.Description)?_this.htmlEncode(item.Description):"";calendarItem.logicalName=item.getPrimaryEntityLogicalName();calendarItem.ensureConstraints();return calendarItem}catch(err){return null}}).where(function(item){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(item)}).items()};CalendarDataAdapter.prototype.destroy=function(){this.htmlEncode=null;this.calendarItemMinDuration=null};CalendarDataAdapter.prototype.getDateValueBasedOnDataSetColumnAttributes=function(columns,dataSetColumnValue,sourceDate,timeZoneConverter){try{var dateColumn=(new MscrmCommon.ArrayQuery(columns)).firstOrDefault(function(column){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(column.alias))return column.alias===dataSetColumnValue;return false});if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(dateColumn))if(dateColumn.attributes.behavior!==CalendarDataAdapter.userLocaleDataSetColumnBehavior)return timeZoneConverter.revertJsBrowserTimezoneShift(sourceDate);return timeZoneConverter.toUserTime(sourceDate)}catch(e){return timeZoneConverter.toUserTime(sourceDate)}};CalendarDataAdapter.userLocaleDataSetColumnBehavior=1;return CalendarDataAdapter}();Calendar.CalendarDataAdapter=CalendarDataAdapter})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarConfiguration=function(){function CalendarConfiguration(){this.itemMinDuration=30;this.pageSize=50}CalendarConfiguration.prototype.destroy=function(){this.shortDateFormatter=null;this.timeSeparator=null;this.shortDateFormatter=null;this.showWeekNumbers=null;this.weekNumberCalculator=null;this.weekStartsOnMonday=null;this.itemMinDuration=null;this.theme=null;this.longDateFormatter=null};return CalendarConfiguration}();Calendar.CalendarConfiguration=CalendarConfiguration})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarConfigurationFactory=function(){function CalendarConfigurationFactory(){}CalendarConfigurationFactory.prototype.create=function(configBag,timeZoneConverter,calendarState){var _this=this,configuration=new Calendar.CalendarConfiguration;configuration.shortDateFormatter=configBag.formatting.formatDateShort;configuration.longDateFormatter=configBag.formatting.formatDateLong;configuration.formatDateLongAbbreviated=configBag.formatting.formatDateLongAbbreviated;configuration.yearMonthDateFormatter=configBag.formatting.formatDateYearMonth;configuration.weekStartsOnMonday=this.isWeekStartMonday(configBag.client.dateFormattingInfo.FirstDayOfWeek);configuration.shortTimePattern=configBag.client.dateFormattingInfo.ShortTimePattern;configuration.timeSeparator=configBag.client.dateFormattingInfo.TimeSeparator;configuration.showWeekNumbers=configBag.client.orgSettings.showWeekNumber;configuration.weekNumberCalculator=configBag.formatting.getWeekOfYear;configuration.itemMinDuration=30;configuration.theme=configBag.theming;configuration.amDesignator=configBag.client.dateFormattingInfo.AMDesignator;configuration.pmDesignator=configBag.client.dateFormattingInfo.PMDesignator;configuration.selectedView=MscrmCommon.ControlUtils.Object.isNullOrUndefined(calendarState.selectedView)?"week":calendarState.selectedView;configuration.selectedDate=MscrmCommon.ControlUtils.Object.isNullOrUndefined(calendarState.selectedDate)?timeZoneConverter.getUserTimeNow():calendarState.selectedDate;configuration.getEntityColor=function(entityLogicalName){return _this.getEntityColor(configBag.theming,entityLogicalName)};configuration.userAgent=configBag.client.userAgent;return configuration};CalendarConfigurationFactory.prototype.getEntityColor=function(theme,entityLogicalName){var entityColor=null;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(theme.getEntityColor))entityColor=theme.getEntityColor(entityLogicalName);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityColor))entityColor=theme.defaultentitycolor;return entityColor};CalendarConfigurationFactory.prototype.isWeekStartMonday=function(dayOfWeek){return dayOfWeek===Mscrm.DayOfWeek.Monday};return CalendarConfigurationFactory}();Calendar.CalendarConfigurationFactory=CalendarConfigurationFactory})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var TimeZoneConverter=function(){function TimeZoneConverter(getUserTimeZoneUtcOffset){this.getUserTimeZoneUtcOffset=getUserTimeZoneUtcOffset}TimeZoneConverter.prototype.toUserTime=function(sourceDate){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(sourceDate))return sourceDate;return new Date(sourceDate.getTime()+(this.getUserTimeZoneUtcOffset(sourceDate)+sourceDate.getTimezoneOffset())*6e4)};TimeZoneConverter.prototype.fromUserTime=function(sourceDate){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(sourceDate))return sourceDate;return new Date(sourceDate.getTime()-(sourceDate.getTimezoneOffset()+this.getUserTimeZoneUtcOffset(sourceDate))*6e4)};TimeZoneConverter.prototype.revertJsBrowserTimezoneShift=function(sourceDate){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(sourceDate))return sourceDate;return new Date(sourceDate.getTime()+sourceDate.getTimezoneOffset()*6e4)};TimeZoneConverter.prototype.getUserTimeNow=function(){return this.toUserTime(new Date)};return TimeZoneConverter}();Calendar.TimeZoneConverter=TimeZoneConverter})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var FormatterProvider=function(){function FormatterProvider(){}FormatterProvider.prototype.dateSpanFormatter=function(dateFormatter){return function(start,end){var dateSpanFromContainer=$("<span />");dateSpanFromContainer.text(dateFormatter(start));var dateSpanToContainer=$("<span />");dateSpanToContainer.text(dateFormatter(end));var dateSpanContainer=$("<span />");dateSpanContainer.addClass("calendar_weekview_title");dateSpanContainer.append(dateSpanFromContainer,$("<span />").text(" - "),dateSpanToContainer);return $("<div />").append(dateSpanContainer).html()}};FormatterProvider.prototype.dateSpanFormatterWithWeekNumber=function(weekNumberCalculator,dateFormatter){var _this=this;return function(start,end){var spanFormatter=_this.dateSpanFormatter(dateFormatter);return spanFormatter(start,end)+" ("+weekNumberCalculator(start)+")"}};FormatterProvider.prototype.weekFormatter=function(weekStartsOnMonday,dateFormatter){var _this=this;return function(date){var weekStartDate=_this.getWeekStartDate(date,weekStartsOnMonday),weekEndDate=_this.addDays(weekStartDate,6),spanFormatter=_this.dateSpanFormatter(dateFormatter);return spanFormatter(weekStartDate,weekEndDate)}};FormatterProvider.prototype.weekFormatterWithWeekNumber=function(weekStartsOnMonday,dateFormatter,weekNumberCalculator){var _this=this;return function(date){var spanFormatter=_this.weekFormatter(weekStartsOnMonday,dateFormatter),dateSpanContainer=$("<div />");dateSpanContainer.append(spanFormatter(date));var weekNumberContainer=$("<span />");weekNumberContainer.addClass("calendar_weekview_title");weekNumberContainer.append($("<span />").append(" ("+weekNumberCalculator(date)+")"));dateSpanContainer.append(weekNumberContainer);return $("<div />").append(dateSpanContainer).html()}};FormatterProvider.prototype.getScaleTimeFormatPattern=function(configuration){return this.addAmPmDesignatorPatternString(configuration.shortTimePattern,this.getHour(configuration.shortTimePattern))};FormatterProvider.prototype.getTimeFormatPattern=function(configuration){var minute="%i";return this.addAmPmDesignatorPatternString(configuration.shortTimePattern,this.getHour(configuration.shortTimePattern)+this.getTimeSeparator(configuration.timeSeparator)+minute)};FormatterProvider.prototype.dateToStringExtended=function(originalDateToString,configuration){var longDateFormatter=configuration.longDateFormatter,amDesignator=configuration.amDesignator,pmDesignator=configuration.pmDesignator;return function(format){if(format===Calendar.DateFormatConstants.longDateFormat)return function(date){return longDateFormatter(date)};else{var formattingMethod=originalDateToString(format);return function(date){var value=formattingMethod(date);value=value.replace(/am/i,amDesignator);value=value.replace(/pm/i,pmDesignator);return value}}}};FormatterProvider.prototype.getHour=function(source){var hour=this.isLeadingZero(source)?"%h":"%g";return this.is24H(source)?hour.toUpperCase():hour};FormatterProvider.prototype.addAmPmDesignatorPatternString=function(source,pattern){if(this.isAmPmBeginning(source))return "%A"+pattern;else if(this.isAmPmEnd(source))return pattern+"%A";return pattern};FormatterProvider.prototype.is24H=function(source){return /H/.test(source)};FormatterProvider.prototype.isLeadingZero=function(source){return /hh/i.test(source)};FormatterProvider.prototype.isAmPmBeginning=function(source){return /^tt/i.test(source)};FormatterProvider.prototype.isAmPmEnd=function(source){return /tt$/i.test(source)};FormatterProvider.prototype.getTimeSeparator=function(sourceTimeSeparator){return sourceTimeSeparator?sourceTimeSeparator:":"};FormatterProvider.prototype.getWeekStartDate=function(date,weekStartsOnMonday){var d=new Date(date.valueOf()),shiftDays=d.getDay();if(weekStartsOnMonday)if(shiftDays===0)shiftDays=6;else shiftDays--;return this.addDays(d,-1*shiftDays)};FormatterProvider.prototype.addDays=function(date,days){var d=new Date(date.valueOf());d.setDate(d.getDate()+days);return d};return FormatterProvider}();Calendar.FormatterProvider=FormatterProvider})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarControlManager=function(){function CalendarControlManager(calendarControlProxy,dataAdapter,navigateEditItem,filterManagerFactory,pageSize,calendarConfigurationBag){this.wasNextPageRequested=false;this.isFilterReqestPending=false;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(calendarControlProxy))throw new Error("Missing argument : calendarControlProxy");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(dataAdapter))throw new Error("Missing argument : dataAdapter");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(navigateEditItem))throw new Error("Missing argument : navigateEditItem");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(pageSize))throw new Error("Missing argument : pageSize");this.dataAdapter=dataAdapter;this.calendarControlProxy=calendarControlProxy;this.navigateEditItem=navigateEditItem;this.filterManagerFactory=filterManagerFactory;this.pageSize=pageSize;this.calendarConfigurationBag=calendarConfigurationBag}CalendarControlManager.prototype.initialize=function(calendarDataSet){this.calendarDataSet=calendarDataSet;this.filterManager=this.filterManagerFactory.create(calendarDataSet.filtering);this.setSorting(calendarDataSet.sorting);this.setPaging(calendarDataSet.paging);this.calendarControlProxy.addProxyHandler(Calendar.CalendarControlProxyEvent.OnDateRangeChanged,this.setFilter,this);this.calendarControlProxy.addProxyHandler(Calendar.CalendarControlProxyEvent.OnClick,this.onClick,this);this.calendarControlProxy.initialize()};CalendarControlManager.prototype.destroy=function(){!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.dataAdapter)&&this.dataAdapter.destroy();!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.calendarControlProxy)&&this.calendarControlProxy.destroy();!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.filterManager)&&this.filterManager.destroy();!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.filterManagerFactory)&&this.filterManagerFactory.destroy();this.dataAdapter=null;this.calendarControlProxy=null;this.filterManager=null;this.navigateEditItem=null;this.wasNextPageRequested=null;this.isFilterReqestPending=null;this.calendarDataSet=null;this.calendarConfigurationBag=null};CalendarControlManager.prototype.render=function(calendarDataSet){this.wasNextPageRequested=false;this.calendarDataSet=calendarDataSet;var filterExpression=this.filterManager.filterExpression;!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.filterManager)&&this.filterManager.destroy();this.filterManager=this.filterManagerFactory.create(this.calendarDataSet.filtering);if(this.isFilterReqestPending&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(filterExpression)){this.filterManager.setFilterExpression(filterExpression);this.isFilterReqestPending=false;this.calendarDataSet.refresh();return}this.showItems(this.calendarDataSet);this.loadNextPage(this.calendarDataSet.paging)};CalendarControlManager.prototype.onActivationChanged=function(isActive){this.calendarControlProxy.onActivationChanged(isActive)};CalendarControlManager.prototype.getState=function(){return this.calendarControlProxy.getState()};CalendarControlManager.prototype.setFilter=function(descriptor){var newStartDate=descriptor.newStartDate,newEndDate=descriptor.newEndDate;this.filterManager.setFilter(newStartDate,newEndDate);if(this.wasNextPageRequested)this.isFilterReqestPending=true;else this.calendarDataSet.refresh()};CalendarControlManager.prototype.onClick=function(calendarItem){var entityReference=Calendar.CalendarEntityReference.create(this.calendarConfigurationBag,calendarItem);this.navigateEditItem(entityReference)};CalendarControlManager.prototype.loadNextPage=function(paging){if(paging.hasNextPage){this.wasNextPageRequested=true;paging.loadNextPage()}};CalendarControlManager.prototype.showItems=function(calendarDataSet){var calendarItems=this.dataAdapter.getCalendarItems(calendarDataSet);this.calendarControlProxy.showCalendarItems(calendarItems)};CalendarControlManager.prototype.setSorting=function(sorting){var startDateSorting=new MscrmCommon.DataSetColumnSortStatus;startDateSorting.sortDirection=Mscrm.ColumnSortDirection.Ascending;startDateSorting.name=Calendar.DataSetColumn.StartDate;sorting.length=0;sorting.push(startDateSorting)};CalendarControlManager.prototype.setPaging=function(paging){paging.setPageSize(this.pageSize)};return CalendarControlManager}();Calendar.CalendarControlManager=CalendarControlManager})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarItem=function(){function CalendarItem(minimumDurationInMinutes){if(minimumDurationInMinutes===void 0)minimumDurationInMinutes=30;this.minDurationInMinutes=minimumDurationInMinutes}CalendarItem.prototype.getMinimumDurationInMinutes=function(){return this.minDurationInMinutes};CalendarItem.prototype.ensureConstraints=function(){if(!this.hasStartDate()&&!this.hasEndDate())throw new Error("Neither start date nor end date is set.");if(this.hasStartDate()&&!this.hasEndDate())if(this.hasDuration())this.end_date=new Date(this.start_date.getTime()+this.minutesAsMilliseconds(this.durationInMinutes));else this.end_date=this.addMinDuration(this.start_date);if(!this.hasStartDate()&&this.hasEndDate())if(this.hasDuration())this.start_date=new Date(this.end_date.getTime()-this.minutesAsMilliseconds(this.durationInMinutes));else this.start_date=this.substractMinDuration(this.end_date);this.ensureMinimumItemDuration()};CalendarItem.prototype.ensureMinimumItemDuration=function(){var minimumEndDate=this.addMinDuration(this.start_date);if(this.end_date<minimumEndDate)this.end_date=minimumEndDate};CalendarItem.prototype.addMinDuration=function(date){return new Date(date.getTime()+this.minutesAsMilliseconds(this.minDurationInMinutes))};CalendarItem.prototype.substractMinDuration=function(date){return new Date(date.getTime()-this.minutesAsMilliseconds(this.minDurationInMinutes))};CalendarItem.prototype.minutesAsMilliseconds=function(minutes){return minutes*60*1e3};CalendarItem.prototype.millisecondsAsMinutes=function(milliseconds){return milliseconds/1e3/60};CalendarItem.prototype.hasEndDate=function(){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.end_date)};CalendarItem.prototype.hasStartDate=function(){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.start_date)};CalendarItem.prototype.hasDuration=function(){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.durationInMinutes)};return CalendarItem}();Calendar.CalendarItem=CalendarItem})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarControlManagerFactory=function(){function CalendarControlManagerFactory(){}CalendarControlManagerFactory.prototype.create=function(controlType,containerId,calendarConfigurationBag,calendarState,timeZoneConverter){var configuration=(new Calendar.CalendarConfigurationFactory).create(calendarConfigurationBag,timeZoneConverter,calendarState),filterManagerFactory=new Calendar.FilterManagerFactory(timeZoneConverter,calendarConfigurationBag.formatting.formatDateAsFilterStringInUTC,configuration.itemMinDuration),locale=(new Calendar.CalendarLocaleProvider(calendarConfigurationBag.resources.getString,calendarConfigurationBag.client.dateFormattingInfo)).get(),calendarControlProxy=(new Calendar.CalendarControlProxyFactory(controlType,containerId,configuration,locale,timeZoneConverter)).create(),dataAdapter=new Calendar.CalendarDataAdapter(calendarConfigurationBag.utils.crmHtmlEncode,configuration.itemMinDuration,timeZoneConverter),navigateEdit=calendarConfigurationBag.navigation.openEditForm;return new Calendar.CalendarControlManager(calendarControlProxy,dataAdapter,navigateEdit,filterManagerFactory,configuration.pageSize,calendarConfigurationBag)};return CalendarControlManagerFactory}();Calendar.CalendarControlManagerFactory=CalendarControlManagerFactory})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}__.prototype=b.prototype;d.prototype=new __},MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarControl=function(_super){__extends(CalendarControl,_super);function CalendarControl(){_super.call(this);this.calendarControlManagerFactory=new Calendar.Advanced.ControlManagerFactory;this.shouldPreventMultipleEventTypes=false;this.updateEvents.shouldIgnoreEvent(Mscrm.UpdateEventType.Activation,false)}CalendarControl.prototype.initCore=function(context,state){if(context.parameters.Calendar.hasError){this.showError(context);return}var availableWidth=context.client.maxAvailableWidth,availableHeight=context.client.viewportHeight;this.controlType=(new Calendar.CalendarControlTypeProvider(context.client.formFactor,availableWidth)).getControlType();this.containerId=MscrmCommon.ControlUtils.ControlGuidGenerator.newGuid("scheduler_container");var containerBuilder=(new Calendar.ContainerBuilderFactory(this.controlType,availableWidth,availableHeight,this.containerId)).create();this.container.innerHTML=containerBuilder.build();var timeZoneConverter=new Calendar.TimeZoneConverter(context.client.getUserTimeZoneUtcOffset);this.calendarStateHandler=new Calendar.CalendarStateHandler(timeZoneConverter,context.utils.setState,state);this.calendarControl=this.calendarControlManagerFactory.create(this.controlType,this.containerId,context,this.calendarStateHandler.retrieve(),timeZoneConverter);this.calendarControl.initialize(context.parameters.Calendar)};CalendarControl.prototype.updateCore=function(dataBag){var _this=this;if(dataBag.parameters.Calendar.hasError){this.showError(dataBag);return}if(Mscrm.UpdateEvents.hasEvent(dataBag.updatedProperties,Mscrm.UpdateEventType.Activation)){this.calendarControl.onActivationChanged(dataBag.mode.isActive);if(dataBag.updatedProperties.length===1)return}this.calendarStateHandler.save(this.calendarControl.getState());var promise=dataBag.parameters.Calendar.generateAdditionalAttributes();if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(promise))this.calendarControl.render(dataBag.parameters.Calendar);else promise.always(function(){_this.calendarControl.render(dataBag.parameters.Calendar)})};CalendarControl.prototype.getOutputsCore=function(){return null};CalendarControl.prototype.destroyCore=function(){!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.calendarControl)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.calendarStateHandler)&&this.calendarStateHandler.save(this.calendarControl.getState());this.removeChildControls()};CalendarControl.prototype.removeChildControls=function(){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.calendarControl)){this.calendarControl.destroy();this.calendarControl=null}if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.errorView)){this.errorView.destroy();this.errorView=null}if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.calendarStateHandler)){this.calendarStateHandler.destroy();this.calendarStateHandler=null}this.controlType=null;this.calendarControlManagerFactory=null;this.containerId=null;$(this.container).empty()};CalendarControl.prototype.showError=function(context){this.removeChildControls();var errorViewId=MscrmCommon.ControlUtils.ControlGuidGenerator.newGuid("errorView_container"),locale=(new Calendar.CalendarLocaleProvider(context.resources.getString,context.client.dateFormattingInfo)).get();this.errorView=new Calendar.ErrorView(errorViewId,context.parameters.Calendar.errorMessage,locale);this.container.innerHTML=this.errorView.render()};return CalendarControl}(MscrmCommon.CommonControl);Calendar.CalendarControl=CalendarControl})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){(function(CalendarControlProxyEvent){CalendarControlProxyEvent[CalendarControlProxyEvent["OnDateRangeChanged"]=0]="OnDateRangeChanged";CalendarControlProxyEvent[CalendarControlProxyEvent["OnClick"]=1]="OnClick"})(Calendar.CalendarControlProxyEvent||(Calendar.CalendarControlProxyEvent={}));var CalendarControlProxyEvent=Calendar.CalendarControlProxyEvent})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var DhtmlxConstants=function(){function DhtmlxConstants(){}DhtmlxConstants.eventOnViewChange="onViewChange";DhtmlxConstants.eventOnClick="onClick";DhtmlxConstants.eventOnTemplatesReady="onTemplatesReady";DhtmlxConstants.eventOnBeforeTodayDisplayed="onBeforeTodayDisplayed";return DhtmlxConstants}();Calendar.DhtmlxConstants=DhtmlxConstants})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var DateFormatConstants=function(){function DateFormatConstants(){}DateFormatConstants.longDateFormat="%D, %d %M";return DateFormatConstants}();Calendar.DateFormatConstants=DateFormatConstants})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var DataSetColumn=function(){function DataSetColumn(){}DataSetColumn.StartDate="StartDate";DataSetColumn.EndDate="EndDate";DataSetColumn.Description="Description";DataSetColumn.Duration="Duration";return DataSetColumn}();Calendar.DataSetColumn=DataSetColumn})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var FilterManager=function(){function FilterManager(dataSetFiltering,timeZoneConverter,minDurationInMinutes){this.startDateFilterShiftInDays=1;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(dataSetFiltering))throw new Error("Missing argument : dataSetFiltering");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(timeZoneConverter))throw new Error("Missing argument : timeZoneConverter");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(minDurationInMinutes))throw new Error("Missing argument : minDurationInMinutes");this.dataSetFiltering=dataSetFiltering;this.timeZoneConverter=timeZoneConverter;this.minDurationInMinutes=minDurationInMinutes}FilterManager.prototype.setFilter=function(startDate,endDate){var startDateCondition=new MscrmCommon.ConditionExpression;startDateCondition.attributeName=Calendar.DataSetColumn.StartDate;startDateCondition.conditionOperator=Mscrm.ConditionOperator.LessThan;startDateCondition.value=this.formatDateForFilter(this.clearTime(endDate));var startDateFilter=new MscrmCommon.FilterExpression;startDateFilter.filterOperator=Mscrm.FilterOperator.And;startDateFilter.conditions=[startDateCondition];var endDateConditionOne=new MscrmCommon.ConditionExpression;endDateConditionOne.attributeName=this.isMappingDefined(Calendar.DataSetColumn.EndDate)?Calendar.DataSetColumn.EndDate:Calendar.DataSetColumn.StartDate;endDateConditionOne.conditionOperator=Mscrm.ConditionOperator.GreaterEqual;var conditionOneDate=this.clearTime(startDate);endDateConditionOne.value=this.formatDateForFilter(conditionOneDate);var endDateConditionTwo=new MscrmCommon.ConditionExpression;endDateConditionTwo.attributeName=Calendar.DataSetColumn.StartDate;endDateConditionTwo.conditionOperator=Mscrm.ConditionOperator.GreaterEqual;var conditionTwoDate=new Date(this.clearTime(startDate).getTime()-this.startDateFilterShiftInDays*FilterManager.dayInMilliseconds);endDateConditionTwo.value=this.formatDateForFilter(conditionTwoDate);var endDateFilter=new MscrmCommon.FilterExpression;endDateFilter.filterOperator=Mscrm.FilterOperator.Or;endDateFilter.conditions=[endDateConditionOne,endDateConditionTwo];var filterExpression=new MscrmCommon.FilterExpression;filterExpression.filterOperator=Mscrm.FilterOperator.And;filterExpression.filters=[startDateFilter,endDateFilter];this.setFilterExpression(filterExpression)};FilterManager.prototype.setFilterExpression=function(filterExpression){this.filterExpression=filterExpression;this.dataSetFiltering.setFilter(this.filterExpression)};FilterManager.prototype.destroy=function(){this.filterExpression=null;this.dataSetFiltering=null;this.timeZoneConverter=null};FilterManager.prototype.isMappingDefined=function(columnName){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.dataSetFiltering.aliasMap[columnName])};FilterManager.prototype.formatDateForFilter=function(date){var serversideStartDate=this.timeZoneConverter.fromUserTime(date);return serversideStartDate.toISOString()};FilterManager.prototype.clearTime=function(date){date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);return date};FilterManager.dayInMilliseconds=8.64e7;FilterManager.minuteInMilliseconds=6e4;return FilterManager}();Calendar.FilterManager=FilterManager})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var FilterManagerFactory=function(){function FilterManagerFactory(timeZoneConverter,dateFormatterInUTC,minDurationInMinutes){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(timeZoneConverter))throw new Error("Missing argument : timeZoneConverter");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(dateFormatterInUTC))throw new Error("Missing argument : dateFormatterInUTC");this.timeZoneConverter=timeZoneConverter;this.dateFormatterInUTC=dateFormatterInUTC;this.minDurationInMinutes=minDurationInMinutes}FilterManagerFactory.prototype.create=function(dataSetFiltering){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(dataSetFiltering))throw new Error("Missing argument : dataSetFiltering");return new Calendar.FilterManager(dataSetFiltering,this.timeZoneConverter,this.minDurationInMinutes)};FilterManagerFactory.prototype.destroy=function(){this.timeZoneConverter=null;this.dateFormatterInUTC=null};return FilterManagerFactory}();Calendar.FilterManagerFactory=FilterManagerFactory})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var DhtmlxSchedulerContainerBuilder=function(){function DhtmlxSchedulerContainerBuilder(width,height,containerId){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(containerId))throw new Error("Id for scheduler container not set.");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(width))throw new Error("The container width is not set.");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(height))throw new Error("The container height is not set.");this.width=width;this.height=height;this.containerId=containerId}DhtmlxSchedulerContainerBuilder.prototype.build=function(){var calendarContainer=$("<div />");calendarContainer.attr("id",this.containerId);calendarContainer.addClass("dhx_cal_container");calendarContainer.height(this.height);calendarContainer.width(this.width);var navigationContainer=$("<div />");navigationContainer.addClass("dhx_cal_navline");if(this.width>=200){var prevPeriodElement=$("<div />");prevPeriodElement.addClass("dhx_cal_prev_button symbolFont Collapsed-symbol rotate180");navigationContainer.append(prevPeriodElement);var nextPeriodElement=$("<div />");nextPeriodElement.addClass("dhx_cal_next_button symbolFont Collapsed-symbol");navigationContainer.append(nextPeriodElement);var todayElement=$("<div />");todayElement.addClass("dhx_cal_today_button");navigationContainer.append(todayElement)}if(this.width>=400){var dayViewElement=$("<div />");dayViewElement.addClass("dhx_cal_tab");dayViewElement.attr("id","day");dayViewElement.attr("name","day_tab");navigationContainer.append(dayViewElement);var weekDividerElement=$("<div />");weekDividerElement.text("|");weekDividerElement.addClass("dhx_cal_tab divider_week");navigationContainer.append(weekDividerElement);var weekViewElement=$("<div />");weekViewElement.addClass("dhx_cal_tab");weekViewElement.attr("id","week");weekViewElement.attr("name","week_tab");navigationContainer.append(weekViewElement)}if(this.width>=600){var monthDividerElement=$("<div />");monthDividerElement.text("|");monthDividerElement.addClass("dhx_cal_tab divider_month");navigationContainer.append(monthDividerElement);var monthViewElement=$("<div />");monthViewElement.addClass("dhx_cal_tab");monthViewElement.attr("id","month");monthViewElement.attr("name","month_tab");navigationContainer.append(monthViewElement)}var dateRangeElement=$("<div />");dateRangeElement.addClass("dhx_cal_date");this.width<800&&dateRangeElement.css("display","none");navigationContainer.append(dateRangeElement);calendarContainer.append(navigationContainer);var headerContainer=$("<div />");headerContainer.addClass("dhx_cal_header");calendarContainer.append(headerContainer);var dataContainer=$("<div />");dataContainer.addClass("dhx_cal_data");calendarContainer.append(dataContainer);return $("<div />").append(calendarContainer).html()};return DhtmlxSchedulerContainerBuilder}();Calendar.DhtmlxSchedulerContainerBuilder=DhtmlxSchedulerContainerBuilder})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarEntityReference=function(){function CalendarEntityReference(){}CalendarEntityReference.create=function(context,calendarItem){var newCalendarEntityRef=new CalendarEntityReference;newCalendarEntityRef.Id=context.utils.tryCreateGuid(calendarItem.id);newCalendarEntityRef.LogicalName=calendarItem.logicalName;return newCalendarEntityRef};return CalendarEntityReference}();Calendar.CalendarEntityReference=CalendarEntityReference})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var WebixProxy=function(){function WebixProxy(webixScheduler,webix,containerId,eventManager,locale,configuration,formatterProvider,iconProvider,timeZoneConverter){this.detachHandlerActions=[];if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(webixScheduler))throw new Error("Missing argument : webixScheduler");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(containerId))throw new Error("Missing argument : containerId");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(eventManager))throw new Error("Missing argument : eventManager");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(webix))throw new Error("Missing argument : webix");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(locale))throw new Error("Missing argument : locale");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(configuration))throw new Error("Missing argument : configuration");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(formatterProvider))throw new Error("Missing argument : formatterProvider");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(iconProvider))throw new Error("Missing argument : iconProvider");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(timeZoneConverter))throw new Error("Missing argument : timeZoneConverter");this.containerId=containerId;this.schedulerId="webix"+containerId;this.webixScheduler=webixScheduler;this.eventManager=eventManager;this.webix=webix;this.locale=locale;this.configuration=configuration;this.formatterProvider=formatterProvider;this.timeZoneConverter=timeZoneConverter;WebixProxy.theme=configuration.theme;WebixProxy.getEntityColor=configuration.getEntityColor;WebixProxy.iconProvider=iconProvider}WebixProxy.prototype.initialize=function(){this.configureProxy();this.initializeProxy()};WebixProxy.prototype.configureProxy=function(){this.configure();this.setState(this.configuration.selectedView,this.configuration.selectedDate)};WebixProxy.prototype.initializeProxy=function(){var _this=this;this.webix.ready(function(){_this.setLocale();_this.webix.ui({view:"scheduler",id:_this.schedulerId,container:_this.containerId});_this.setToolbarLocale();_this.configureAllDaysOfWeekUseEqualEventHandlers();_this.setupDateRangeChangeHandler();_this.setupItemClickHandler();_this.setupCalendarHeaderDateFormatFunction();_this.triggerFirstOnDateRangeChanged()})};WebixProxy.prototype.getState=function(){var state=new Calendar.CalendarState;state.selectedDate=this.getSelectedDate();state.selectedView=this.getSelectedViewButtonId();return state};WebixProxy.prototype.destroy=function(){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.detachHandlerActions)){for(var i=0;i<this.detachHandlerActions.length;i++){this.detachHandlerActions[i]();this.detachHandlerActions[i]=null}this.detachHandlerActions=null}if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(WebixProxy.detachStaticHandlerActions)){for(var i=0;i<WebixProxy.detachStaticHandlerActions.length;i++){WebixProxy.detachStaticHandlerActions[i]();WebixProxy.detachStaticHandlerActions[i]=null}WebixProxy.detachStaticHandlerActions=null}!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.eventManager)&&this.eventManager.removeAllHandlers();if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.schedulerId)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.webix.$$(this.schedulerId))){this.webix.$$(this.schedulerId).clearAll();this.webix.$$(this.schedulerId).$$(Calendar.WebixConstants.calendarDivId).config.calendarHeader=null}!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.locale)&&this.locale.destroy();this.containerId=null;this.eventManager=null;this.detachHandlerActions=null;this.locale=null;this.configuration.destroy();this.configuration=null;this.formatterProvider=null;for(var controlDestructorsIndexes=[],index=0;index<this.webix.destructors.length;index++){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.webix.destructors[index])||MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.webix.destructors[index].getTopParentView)||this.webix.destructors[index].getTopParentView().config.id!==this.schedulerId)continue;controlDestructorsIndexes.push(index)}for(var index=0;index<controlDestructorsIndexes.length;index++){var destructorIndex=controlDestructorsIndexes[index];this.webix.destructors[destructorIndex].destructor();for(var field in this.webix.destructors[destructorIndex]){var isValidToDelete=true;if(field==="on_mouse_move")isValidToDelete=false;else if(field==="callEvent"){isValidToDelete=false;this.webix.destructors[destructorIndex].callEvent=function(){}}else for(var mouseEventsField in this.webix.MouseEvents)if(mouseEventsField===field){isValidToDelete=false;break}if(isValidToDelete)this.webix.destructors[destructorIndex][field]=null}this.webix.destructors[destructorIndex].$destructed=true;delete this.webix.destructors[destructorIndex]}for(var index=this.webix.destructors.length-1;index>=0;index--)MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.webix.destructors[index])&&this.webix.destructors.splice(index,1);this.schedulerId=null};WebixProxy.prototype.showCalendarItems=function(calendarItems){var _this=this;this.webix.ready(function(){var scheduler=_this.webix.$$(_this.schedulerId);if(calendarItems.length!==0)scheduler.parse(calendarItems,"json");else scheduler.clearAll();try{var dayView=scheduler.$$(Calendar.WebixConstants.dayListId),currentHour=(new Date).getHours();dayView.scrollTo(0,currentHour*dayView.config.timeScaleHeight)}catch(e){}})};WebixProxy.prototype.onActivationChanged=function(isActive){};WebixProxy.prototype.addProxyHandler=function(event,handler,context){this.eventManager.addHandler(event,handler,context)};WebixProxy.prototype.removeProxyHandler=function(event){this.eventManager.removeHandler(event)};WebixProxy.prototype.triggerEvent=function(event,eventDescriptor){this.eventManager.triggerEvent(event,eventDescriptor)};WebixProxy.dayEventStyleTemplate=function(obj){var style="",theme=MscrmControls.Calendar.WebixProxy.theme;if(theme)style+="border-color:"+WebixProxy.getEntityColor(obj.logicalName)+";";return style};WebixProxy.prototype.setState=function(view,date){this.webixScheduler.config.init_date=date;this.webixScheduler.config.mode=view;var toolbar=(new MscrmCommon.ArrayQuery(this.webixScheduler.config.bottom_toolbar)).firstOrDefault(function(item){return item.view==="segmented"});if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(toolbar))toolbar.value=view};WebixProxy.prototype.attachEvent=function(view,event,functor,id){var eventId=view.attachEvent(event,functor);this.detachHandlerActions.push(function(){return view.detachEvent(eventId)})};WebixProxy.prototype.attachWebixEvent=function(webixStatic,event,functor,id){var eventId=webixStatic.attachEvent(event,functor);this.detachHandlerActions.push(function(){return webixStatic.detachEvent(eventId)})};WebixProxy.prototype.setupCalendarHeaderDateFormatFunction=function(){this.webix.$$(this.schedulerId).$$(Calendar.WebixConstants.calendarDivId).config.calendarHeader=this.configuration.yearMonthDateFormatter};WebixProxy.prototype.setupDateRangeChangeHandler=function(){var _this=this,scheduler=this.webix.$$(this.schedulerId);this.attachEvent(scheduler.$$(Calendar.WebixConstants.viewChangeButtonsId),Calendar.WebixConstants.onAfterTabClick,function(buttonId){var selectedDate=_this.getSelectedDate(),startDate=_this.getStartDate(buttonId,selectedDate),endDate=_this.getEndDate(buttonId,startDate);_this.triggerOnDateRangeChanged(startDate,endDate)});this.attachEvent(scheduler,Calendar.WebixConstants.onItemClick,function(id){var buttonId=_this.webix.$$(_this.schedulerId).innerId(id);if(buttonId===Calendar.WebixConstants.todayButtonId){var selectedDate=_this.timeZoneConverter.getUserTimeNow(),viewId=_this.getSelectedViewButtonId(),startDate=_this.getStartDate(viewId,selectedDate),endDate=_this.getEndDate(viewId,startDate);_this.webix.$$(_this.schedulerId).coreData.setValue(selectedDate);_this.triggerOnDateRangeChanged(startDate,endDate)}});this.attachEvent(scheduler.$$(Calendar.WebixConstants.previousDayButtonId),Calendar.WebixConstants.onItemClick,function(){_this.triggerDateRangeChangeOnNavigation(-1,Calendar.WebixConstants.dayViewButtonId)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.nextDayButtonId),Calendar.WebixConstants.onItemClick,function(){_this.triggerDateRangeChangeOnNavigation(1,Calendar.WebixConstants.dayViewButtonId)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.previousWeekButtonId),Calendar.WebixConstants.onItemClick,function(){_this.triggerDateRangeChangeOnNavigation(-1,Calendar.WebixConstants.weekViewButtonId)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.nextWeekButtonId),Calendar.WebixConstants.onItemClick,function(){_this.triggerDateRangeChangeOnNavigation(1,Calendar.WebixConstants.weekViewButtonId)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.calendarDivId),Calendar.WebixConstants.onAfterMonthChange,function(){var newSelectedDate=_this.getSelectedDate(),startDate=webix.Date.monthStart(newSelectedDate),endDate=_this.getEndDate(Calendar.WebixConstants.monthViewButtonId,startDate);_this.triggerOnDateRangeChanged(startDate,endDate)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.calendarDivId),Calendar.WebixConstants.onChange,function(newDate){var oldDate=_this.getSelectedDate();if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(newDate)||MscrmCommon.ControlUtils.Object.isNullOrUndefined(oldDate))return;if(newDate.getMonth()===oldDate.getMonth()&&newDate.getFullYear()===oldDate.getFullYear())return;var startDate=webix.Date.monthStart(newDate),endDate=_this.getEndDate(Calendar.WebixConstants.monthViewButtonId,startDate);_this.triggerOnDateRangeChanged(startDate,endDate)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.calendarDivId),Calendar.WebixConstants.onAfterRender,function(newDate){_this.setThemeColors()})};WebixProxy.prototype.triggerDateRangeChangeOnNavigation=function(dateIncrement,viewId){var oldSelectedDate=this.getSelectedDate(),newSelectedDate=webix.Date.add(oldSelectedDate,dateIncrement,viewId,true),startDate=this.getStartDate(viewId,newSelectedDate),endDate=this.getEndDate(viewId,startDate);this.triggerOnDateRangeChanged(startDate,endDate)};WebixProxy.prototype.getStartDate=function(viewId,baseDate){switch(viewId){case Calendar.WebixConstants.dayViewButtonId:return this.webix.Date.dayStart(baseDate);case Calendar.WebixConstants.weekViewButtonId:return this.webix.Date.weekStart(baseDate);case Calendar.WebixConstants.monthViewButtonId:return this.webix.Date.monthStart(baseDate);default:throw new Error("The selected view mode is not supported")}};WebixProxy.prototype.getEndDate=function(viewId,startDate){return this.webix.Date.add(startDate,1,viewId,true)};WebixProxy.prototype.triggerFirstOnDateRangeChanged=function(){var viewId=this.getSelectedViewButtonId(),selectedDate=this.getSelectedDate(),startDate=this.getStartDate(viewId,selectedDate),endDate=this.getEndDate(viewId,startDate);this.triggerOnDateRangeChanged(startDate,endDate)};WebixProxy.prototype.triggerOnDateRangeChanged=function(startDate,endDate){var _this=this;this.webix.ready(function(){_this.webix.$$(_this.schedulerId).clearAll()});this.setToolbarLocale();this.triggerEvent(Calendar.CalendarControlProxyEvent.OnDateRangeChanged,{newStartDate:startDate,newEndDate:endDate})};WebixProxy.prototype.getSelectedViewButtonId=function(){return this.webix.$$(this.schedulerId).$$(Calendar.WebixConstants.viewChangeButtonsId).data.value};WebixProxy.prototype.getSelectedDate=function(){return this.webix.$$(this.schedulerId).coreData.getValue()};WebixProxy.prototype.setupItemClickHandler=function(){var _this=this,scheduler=this.webix.$$(this.schedulerId);this.attachEvent(scheduler,Calendar.WebixConstants.onBeforeEventShow,function(){return false});this.attachEvent(scheduler.$$(Calendar.WebixConstants.dayListId),Calendar.WebixConstants.onItemClick,function(id,event,node){return _this.onItemClickHandler(id,event,node)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.weekListId),Calendar.WebixConstants.onItemClick,function(id,event,node){return _this.onItemClickHandler(id,event,node)});this.attachEvent(scheduler.$$(Calendar.WebixConstants.monthListId),Calendar.WebixConstants.onItemClick,function(id,event,node){return _this.onItemClickHandler(id,event,node)})};WebixProxy.prototype.onItemClickHandler=function(id,event,node){var scheduler=this.webix.$$(this.schedulerId),item=scheduler.getItem(id);this.triggerEvent(Calendar.CalendarControlProxyEvent.OnClick,item)};WebixProxy.prototype.configureAllDaysOfWeekUseEqualEventHandlers=function(){var calendarView=this.webix.$$(this.schedulerId).$$(Calendar.WebixConstants.calendarDivId);if(calendarView&&calendarView.config)calendarView.config.events=function(day){return ""}};WebixProxy.prototype.setLocale=function(){this.webix.i18n.calendar.dayShort=this.locale.dayShortLabels;this.webix.i18n.calendar.dayFull=this.locale.dayFullLabels;this.webix.i18n.calendar.monthFull=this.locale.monthFullLabels;this.webix.i18n.calendar.monthShort=this.locale.monthShortLabels;this.webixScheduler.locale.labels.label_allday=this.locale.allDayItemLabel;this.webixScheduler.locale.labels.month_tab=this.locale.monthViewLabel;this.webixScheduler.locale.labels.week_tab=this.locale.weekViewLabel;this.webixScheduler.locale.labels.day_tab=this.locale.dayViewLabel;this.webixScheduler.locale.labels.icon_today=this.locale.todayLabel};WebixProxy.prototype.setToolbarLocale=function(){this.setLabel(Calendar.WebixConstants.todayButtonSelector,this.locale.todayLabel);this.setLabel(Calendar.WebixConstants.monthButtonSelector,this.locale.monthViewLabel);this.setLabel(Calendar.WebixConstants.weekButtonSelector,this.locale.weekViewLabel);this.setLabel(Calendar.WebixConstants.dayButtonSelector,this.locale.dayViewLabel)};WebixProxy.prototype.setLabel=function(selector,newLabel){var button=$(selector);button.length>0&&button.text(newLabel)};WebixProxy.prototype.configure=function(){this.configureWebix();this.configureScheduler()};WebixProxy.prototype.configureWebix=function(){var _this=this;this.webix.Date.startOnMonday=this.configuration.weekStartsOnMonday;this.webix.Touch.limit(true);this.webix.Date.dateToStr=this.formatterProvider.dateToStringExtended(this.webix.Date.dateToStr,this.configuration);this.attachWebixEvent(this.webix,Calendar.WebixConstants.onAfterSchedulerInit,function(){_this.webix.i18n.headerFormatStr=function(date){return _this.configuration.shortDateFormatter(date)};_this.webix.i18n.dateFormatStr=_this.configuration.longDateFormatter})};WebixProxy.prototype.configureScheduler=function(){this.webixScheduler.types.multi_day_list.height=34;this.webixScheduler.xy.scale_height=29;this.webixScheduler.xy.min_event_height=27;this.webixScheduler.config.readonly=true;this.webixScheduler.config.hour_date=this.formatterProvider.getTimeFormatPattern(this.configuration);this.webixScheduler.config.scale_hour=this.formatterProvider.getScaleTimeFormatPattern(this.configuration);this.webixScheduler.config.week_header_date=Calendar.DateFormatConstants.longDateFormat;if(this.configuration.showWeekNumbers)this.webixScheduler.templates.week_title=this.formatterProvider.weekFormatterWithWeekNumber(this.configuration.weekStartsOnMonday,this.configuration.shortDateFormatter,this.configuration.weekNumberCalculator);else this.webixScheduler.templates.week_title=this.formatterProvider.weekFormatter(this.configuration.weekStartsOnMonday,this.configuration.shortDateFormatter)};WebixProxy.prototype.setThemeColors=function(){this.setStyle(".webix_cal_body .webix_cal_select span, .webix_cal_body .webix_cal_select.webix_cal_today span",[{style:"background-color",value:WebixProxy.theme.processcontrolcolor,important:true},{style:"border-color",value:WebixProxy.theme.processcontrolcolor,important:false}]);this.setStyle(".webix_cal_body .webix_cal_today span",[{style:"border-color",value:WebixProxy.theme.selectedlinkeffect,important:false}])};WebixProxy.prototype.setStyle=function(selector,styles){var element=$(selector);if(element.length>0)for(var index=0;index<styles.length;index++)if(!styles[index].important)element.css(styles[index].style,styles[index].value);else element.attr("style",function(i,s){var prevStyle="";if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(s))prevStyle=s;return prevStyle+styles[index].style+": "+styles[index].value+" !important;"})};WebixProxy.detachStaticHandlerActions=[];return WebixProxy}();Calendar.WebixProxy=WebixProxy;var eventId=webix.attachEvent("onBeforeSchedulerInit",function(){scheduler.templates.calendar_event=function(day){var calDay=$("<div />");calDay.addClass("cal_day_with_events");calDay.css("color",WebixProxy.theme.globallinkcolor);calDay.text(day.getDate());return $("<div />").append(calDay).html()};scheduler.templates.event_marker=function(obj,type){return $("<div />").append($(Calendar.WebixProxy.iconProvider.generateThemedIcon(obj,WebixProxy.getEntityColor(obj.logicalName),true))).html()};scheduler.templates.day_event_style=Calendar.WebixProxy.dayEventStyleTemplate;scheduler.templates.day_event=function(obj){var icon=Calendar.WebixProxy.iconProvider.generateThemedIcon(obj,WebixProxy.getEntityColor(obj.logicalName),true,"webix_event_marker_relative_position"),eventText=$("<span />");eventText.addClass("webix_event_marker_text webix_day_event_text");eventText.append(obj.text);return $("<div />").append(icon,eventText).html()};scheduler.templates.multi_day_event=function(obj){var icon=Calendar.WebixProxy.iconProvider.generateThemedIcon(obj,WebixProxy.getEntityColor(obj.logicalName),true,"webix_event_marker_relative_position"),text=$("<span />");text.addClass("webix_event_marker_text");text.append(obj.text);return $("<div />").append(icon,text).html()};scheduler.config.bottom_toolbar=[{view:"segmented",id:"buttons",value:"week",align:"left",multiview:true,options:[{id:"day",value:scheduler.locale.labels.day_tab,width:scheduler.xy.day_tab},{id:"",value:"|",width:2},{id:"week",value:scheduler.locale.labels.week_tab,width:scheduler.xy.week_tab},{id:"",value:"|",width:2},{id:"month",value:scheduler.locale.labels.month_tab,width:scheduler.xy.month_tab}]},{view:"label",id:"today",name:"today",css:"toolbar_today",label:scheduler.locale.labels.icon_today,inputWidth:scheduler.xy.icon_today,align:"right",width:scheduler.xy.icon_today+6}];scheduler.config.week_toolbar=[{view:"label",name:"prevWeek",id:"prevWeek",width:35,align:"left",label:"<div class='webix_cal_prev_button'></div>"},{view:"label",id:"weekTitle",align:"center"},{view:"label",id:"nextWeek",align:"right",label:"<div class='webix_cal_next_button'></div>",width:35}];scheduler.locale.labels.label_no_events=""});WebixProxy.detachStaticHandlerActions.push(function(){return webix.detachEvent(eventId)})})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var EventManager=function(){function EventManager(){this.proxyEvents=[]}EventManager.prototype.addHandler=function(event,handler,context){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.proxyEvents[event]))this.proxyEvents[event]=[];this.proxyEvents[event].push({handler:handler,context:context})};EventManager.prototype.removeHandler=function(event){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.proxyEvents[event]))this.proxyEvents[event]=null};EventManager.prototype.triggerEvent=function(event,eventDescriptor){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.proxyEvents[event]))return;(new MscrmCommon.ArrayQuery(this.proxyEvents[event])).each(function(listener){return listener.handler.apply(listener.context,[eventDescriptor])})};EventManager.prototype.removeAllHandlers=function(){this.proxyEvents=[]};return EventManager}();Calendar.EventManager=EventManager})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var WebixConstants=function(){function WebixConstants(){}WebixConstants.onItemClick="onItemClick";WebixConstants.onAfterTabClick="onAfterTabClick";WebixConstants.onAfterMonthChange="onAfterMonthChange";WebixConstants.onBeforeEventShow="onBeforeEventShow";WebixConstants.onAfterSchedulerInit="onAfterSchedulerInit";WebixConstants.onChange="onChange";WebixConstants.onAfterRender="onAfterRender";WebixConstants.viewChangeButtonsId="buttons";WebixConstants.calendarDivId="calendar";WebixConstants.dayListId="dayList";WebixConstants.weekListId="weekEventsList";WebixConstants.monthListId="calendarDayEvents";WebixConstants.previousDayButtonId="prev";WebixConstants.nextDayButtonId="next";WebixConstants.previousWeekButtonId="prevWeek";WebixConstants.nextWeekButtonId="nextWeek";WebixConstants.dayViewButtonId="day";WebixConstants.weekViewButtonId="week";WebixConstants.monthViewButtonId="month";WebixConstants.todayButtonId="today";WebixConstants.todayButtonSelector=".webix_scheduler .toolbar_today div";WebixConstants.monthButtonSelector=".webix_scheduler [button_id='month']";WebixConstants.weekButtonSelector=".webix_scheduler [button_id='week']";WebixConstants.dayButtonSelector=".webix_scheduler [button_id='day']";WebixConstants.settings="_settings";return WebixConstants}();Calendar.WebixConstants=WebixConstants})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){(function(CalendarControlType){CalendarControlType[CalendarControlType["Webix"]=0]="Webix";CalendarControlType[CalendarControlType["Dhtmlx"]=1]="Dhtmlx"})(Calendar.CalendarControlType||(Calendar.CalendarControlType={}));var CalendarControlType=Calendar.CalendarControlType})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarControlTypeProvider=function(){function CalendarControlTypeProvider(formfactor,width){this.minDhtmlxWidthInPx=600;this.formfactor=formfactor;this.width=width}CalendarControlTypeProvider.prototype.getControlType=function(){if(this.formfactor!==Mscrm.FormFactor.Phone&&this.width>=this.minDhtmlxWidthInPx)return Calendar.CalendarControlType.Dhtmlx;else return Calendar.CalendarControlType.Webix};return CalendarControlTypeProvider}();Calendar.CalendarControlTypeProvider=CalendarControlTypeProvider})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var ContainerBuilderFactory=function(){function ContainerBuilderFactory(controlType,width,height,containerId){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(controlType))throw new Error("The control type is not set.");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(width))throw new Error("The container width is not set.");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(height))throw new Error("The container height is not set.");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(containerId))throw new Error("The container id is not set.");this.controlType=controlType;this.width=width>0?width:250;this.height=height>0?height:500;this.containerId=containerId}ContainerBuilderFactory.prototype.create=function(){switch(this.controlType){case Calendar.CalendarControlType.Dhtmlx:return new Calendar.DhtmlxSchedulerContainerBuilder(this.width,this.height,this.containerId);case Calendar.CalendarControlType.Webix:return new Calendar.WebixContainerBuilder(this.width,this.height,this.containerId);default:throw new Error("The control type is not supported")}};return ContainerBuilderFactory}();Calendar.ContainerBuilderFactory=ContainerBuilderFactory})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var WebixContainerBuilder=function(){function WebixContainerBuilder(width,height,containerId){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(containerId))throw new Error("Id for scheduler container not set.");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(height))throw new Error("The container height is not set.");this.containerId=containerId;this.height=height;this.width=width}WebixContainerBuilder.prototype.build=function(){var htmlObj=$("<div />");htmlObj.attr("id",this.containerId);htmlObj.css("min-height",this.height.toString()+"px");htmlObj.height(this.height);htmlObj.width(this.width);return $("<div />").append(htmlObj).html()};return WebixContainerBuilder}();Calendar.WebixContainerBuilder=WebixContainerBuilder})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarControlProxyFactory=function(){function CalendarControlProxyFactory(controlType,containerId,configuration,locale,timeZoneConverter){this.webixControl=webix;this.dhtmlxSchedulerFactory=Scheduler;this.schedulerStatic=scheduler;this.controlType=controlType;this.containerId=containerId;this.configuration=configuration;this.locale=locale;this.timeZoneConverter=timeZoneConverter}CalendarControlProxyFactory.prototype.create=function(){var formatterProvider=new Calendar.FormatterProvider;switch(this.controlType){case Calendar.CalendarControlType.Webix:return new Calendar.WebixProxy(this.schedulerStatic,this.webixControl,this.containerId,new Calendar.EventManager,this.locale,this.configuration,formatterProvider,new Calendar.IconProvider,this.timeZoneConverter);case Calendar.CalendarControlType.Dhtmlx:return new Calendar.DhtmlxProxy(this.dhtmlxSchedulerFactory.getSchedulerInstance(),this.schedulerStatic,this.containerId,this.configuration,new Calendar.EventManager,this.locale,formatterProvider,new Calendar.IconProvider,this.timeZoneConverter);default:throw new Error("The control type is not supported")}};return CalendarControlProxyFactory}();Calendar.CalendarControlProxyFactory=CalendarControlProxyFactory})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarLocale=function(){function CalendarLocale(){}CalendarLocale.prototype.destroy=function(){this.allDayItemLabel=null;this.todayLabel=null;this.weekViewLabel=null;this.monthViewLabel=null;this.dayViewLabel=null;this.errorViewDefaultErrorMessageLabel=null;this.viewMoreLabel=null;this.monthShortLabels=[];this.monthFullLabels=[];this.dayShortLabels=[];this.dayFullLabels=[]};return CalendarLocale}();Calendar.CalendarLocale=CalendarLocale})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarLocaleProvider=function(){function CalendarLocaleProvider(getString,dateFormattingInfo){this.getString=getString;this.dateFormattingInfo=dateFormattingInfo}CalendarLocaleProvider.prototype.get=function(){var locale=new Calendar.CalendarLocale;locale.allDayItemLabel=this.getString(Calendar.LabelId.allDayItem);locale.dayViewLabel=this.getString(Calendar.LabelId.dayView);locale.monthViewLabel=this.getString(Calendar.LabelId.monthView);locale.todayLabel=this.getString(Calendar.LabelId.today);locale.weekViewLabel=this.getString(Calendar.LabelId.weekView);locale.errorViewDefaultErrorMessageLabel=this.getString(Calendar.LabelId.errorViewDefaultErrorMessage);locale.viewMoreLabel=this.getString(Calendar.LabelId.viewMore);locale.dayFullLabels=this.dateFormattingInfo.DayNames;locale.dayShortLabels=this.dateFormattingInfo.AbbreviatedDayNames;locale.monthFullLabels=this.dateFormattingInfo.MonthNames;locale.monthShortLabels=this.dateFormattingInfo.AbbreviatedMonthNames;return locale};return CalendarLocaleProvider}();Calendar.CalendarLocaleProvider=CalendarLocaleProvider})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var LabelId=function(){function LabelId(){}LabelId.allDayItem="CustomControl_Calendar_AllDayItem";LabelId.today="CustomControl_Calendar_Today";LabelId.weekView="CustomControl_Calendar_WeekView";LabelId.monthView="CustomControl_Calendar_MonthView";LabelId.dayView="CustomControl_Calendar_DayView";LabelId.errorViewDefaultErrorMessage="CustomControl_Calendar_ErrorView_DefaultMessage";LabelId.viewMore="CustomControl_Calendar_ViewMore";return LabelId}();Calendar.LabelId=LabelId})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var IconProvider=function(){function IconProvider(){}IconProvider.prototype.generateThemedIcon=function(item,entityColor,styleForWebix,additionalClass){var schedulerType=styleForWebix?"webix":"dhx",iconContainerStyle={};if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityColor))iconContainerStyle={"background-color":entityColor,"border-color":entityColor};var iconClasses=["crmSymbolFont","entity-symbol",item.logicalName,schedulerType+"_event_marker_icon"].join(" "),icon=$("<span></span>").addClass(iconClasses),iconContainerClasses=[schedulerType+"_event_marker_icon_container ",additionalClass].join(" "),iconContainer=$("<div></div>").addClass(iconContainerClasses).css(iconContainerStyle);return iconContainer.append(icon)};return IconProvider}();Calendar.IconProvider=IconProvider})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var ErrorView=function(){function ErrorView(containerId,errorMessage,locale){if(MscrmCommon.ControlUtils.String.isNullOrEmpty(containerId))throw new Error("Missing argument : containerId");this.containerId=containerId;this.errorMessage=errorMessage||locale.errorViewDefaultErrorMessageLabel}ErrorView.prototype.render=function(){var errorContainer=$("<div></div>").attr("id",this.containerId).addClass(ErrorView.containerCssClass),errorMessage=$("<span></span>").addClass(ErrorView.errorMessageCssClass).text(this.errorMessage),result=$("<div></div>").append(errorContainer.append(errorMessage)).html();return result};ErrorView.prototype.destroy=function(){$("#"+this.containerId).remove();this.containerId=null;this.errorMessage=null};ErrorView.containerCssClass="error_view_container";ErrorView.errorMessageCssClass="error_view_message";return ErrorView}();Calendar.ErrorView=ErrorView})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarStateKey=function(){function CalendarStateKey(){}CalendarStateKey.selectedView="SelectedView";CalendarStateKey.selectedDate="SelectedDate";return CalendarStateKey}();Calendar.CalendarStateKey=CalendarStateKey})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarState=function(){function CalendarState(){}CalendarState.prototype.destroy=function(){this.selectedDate=null;this.selectedView=null};return CalendarState}();Calendar.CalendarState=CalendarState})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict";var CalendarStateHandler=function(){function CalendarStateHandler(timeZoneConverter,setState,state){this.state=state;this.timeZoneConverter=timeZoneConverter;this.setState=setState}CalendarStateHandler.prototype.save=function(state){this.state={};if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(state.selectedDate))this.state[Calendar.CalendarStateKey.selectedDate]=this.timeZoneConverter.fromUserTime(state.selectedDate).toISOString();if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(state.selectedView))this.state[Calendar.CalendarStateKey.selectedView]=state.selectedView;this.setState(this.state)};CalendarStateHandler.prototype.retrieve=function(){var calendarState=new Calendar.CalendarState;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.state)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.state[Calendar.CalendarStateKey.selectedView]))calendarState.selectedView=this.state[Calendar.CalendarStateKey.selectedView];if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.state)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.state[Calendar.CalendarStateKey.selectedDate]))calendarState.selectedDate=this.timeZoneConverter.toUserTime(new Date(this.state[Calendar.CalendarStateKey.selectedDate]));return calendarState};CalendarStateHandler.prototype.destroy=function(){this.timeZoneConverter=null;this.state=null};return CalendarStateHandler}();Calendar.CalendarStateHandler=CalendarStateHandler})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){"use strict"})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var WebixConstants=function(_super){__extends(WebixConstants,_super);function WebixConstants(){_super.apply(this,arguments)}Object.defineProperty(WebixConstants,"StackedWithDurationTimelineCustomFormat",{"get":function(){return "S"},enumerable:true,configurable:true});Object.defineProperty(WebixConstants,"OnAfterLoad",{"get":function(){return "onAfterLoad"},enumerable:true,configurable:true});Object.defineProperty(WebixConstants,"MultiDayEventsContainerSelector",{"get":function(){return ".webix_view.webix_list.multi_day_events"},enumerable:true,configurable:true});return WebixConstants}(Calendar.WebixConstants);Advanced.WebixConstants=WebixConstants})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var Configuration=function(_super){__extends(Configuration,_super);function Configuration(){_super.apply(this,arguments)}return Configuration}(Calendar.CalendarConfiguration);Advanced.Configuration=Configuration})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var DataAdapter=function(_super){__extends(DataAdapter,_super);function DataAdapter(htmlEncode,calendarItemMinDuration,userTimeZoneConverter,configuration,descriptionBuilder,colorProvider){_super.call(this,htmlEncode,calendarItemMinDuration,userTimeZoneConverter);this.configuration=configuration;this.descriptionBuilder=descriptionBuilder;this.colorProvider=colorProvider}DataAdapter.prototype.getCalendarItems=function(calendarDataSet){var _this=this,calendarItems=_super.prototype.getCalendarItems.call(this,calendarDataSet),items=(new MscrmCommon.ArrayQuery(calendarItems)).select(function(calendarItem,index){var item=new Advanced.Item(calendarItem.getMinimumDurationInMinutes()),dataSetRecord=calendarDataSet.records[calendarItem.id];item.displayMode=_this.configuration.displayMode;item.order=index;item.dataSetRecordStartDate=dataSetRecord.StartDate;item.dataSetRecordEndDate=dataSetRecord.EndDate;item.dataSetRecordDuration=dataSetRecord.Duration;item.id=calendarItem.id;item.start_date=calendarItem.start_date;item.end_date=calendarItem.end_date;item.durationInMinutes=calendarItem.durationInMinutes;item.logicalName=calendarItem.logicalName;item.text=_this.descriptionBuilder.buildDescription(dataSetRecord);item.eventColor=_this.colorProvider.calculateItemColor(dataSetRecord);return item}).items();Advanced.DisplayModeUtil.isStackedDisplayMode(this.configuration.displayMode)&&this.convertIntoStack(items);return items};DataAdapter.prototype.convertIntoStack=function(items){var _this=this,topOfStack={};this.configuration.displayMode===Advanced.DisplayMode.StackedWithDurationTimeline&&items.sort(function(a,b){if(a.calculateDurationInMinutes()!=b.calculateDurationInMinutes())return b.calculateDurationInMinutes()-a.calculateDurationInMinutes();return a.order-b.order});(new MscrmCommon.ArrayQuery(items)).each(function(item){var dateString=item.start_date.toDateString();if(_this.isMultiDayEvent(item))return;if(!topOfStack[dateString]||_this.willOverflow(item,topOfStack[dateString])){var top=_this.calculateEndOfDay(item.start_date);topOfStack[dateString]=top}var newEndDate=_this.cloneDate(topOfStack[dateString]),newStartDate=_this.cloneDate(newEndDate),durationInMinutes=_this.calculateVisualEventDurationInMinutes(item);_this.addMinutes(newStartDate,-durationInMinutes);topOfStack[dateString]=_this.cloneDate(newStartDate);_this.configuration.displayMode===Advanced.DisplayMode.StackedWithDurationTimeline&&_this.applyShortEventCorrection(newStartDate,newEndDate,item.getMinimumDurationInMinutes());item.start_date=newStartDate;item.end_date=newEndDate})};DataAdapter.prototype.calculateVisualEventDurationInMinutes=function(item){if(this.configuration.displayMode===Advanced.DisplayMode.StackedWithoutTimeline)return Math.max(item.calculateDurationInMinutes(),item.getMinimumDurationInMinutes());return item.calculateDurationInMinutes()};DataAdapter.prototype.applyShortEventCorrection=function(startDate,endDate,minimumDurationInMinutes){var minimumDurationInMiliseconds=minimumDurationInMinutes*6e4,currentDurationInMiliseconds=endDate.getTime()-startDate.getTime(),durationToIncreaseInMiliseconds=minimumDurationInMiliseconds-currentDurationInMiliseconds,endOfDay=this.calculateEndOfDay(endDate);if(durationToIncreaseInMiliseconds<=0)return;endDate.setTime(Math.min(endOfDay.getTime(),endDate.getTime()+durationToIncreaseInMiliseconds));currentDurationInMiliseconds=endDate.getTime()-startDate.getTime();durationToIncreaseInMiliseconds=minimumDurationInMiliseconds-currentDurationInMiliseconds;if(durationToIncreaseInMiliseconds<=0)return;startDate.setTime(startDate.getTime()-durationToIncreaseInMiliseconds)};DataAdapter.prototype.willOverflow=function(item,top){var topClone=this.cloneDate(top),eventDuration=Math.max(item.calculateDurationInMinutes(),item.getMinimumDurationInMinutes());this.addMinutes(topClone,-eventDuration);return top.getDate()!=topClone.getDate()};DataAdapter.prototype.isMultiDayEvent=function(item){return item.start_date.getDay()!=item.end_date.getDay()||item.start_date.getMonth()!=item.end_date.getMonth()||item.start_date.getFullYear()!=item.end_date.getFullYear()};DataAdapter.prototype.calculateEndOfDay=function(date){var endOfDay=this.cloneDate(date);endOfDay.setHours(23,59,0,0);return endOfDay};DataAdapter.prototype.cloneDate=function(date){return new Date(date.getTime())};DataAdapter.prototype.addMinutes=function(date,minutes){var oneMinuteInMiliseconds=6e4;date.setTime(date.getTime()+minutes*oneMinuteInMiliseconds)};DataAdapter.prototype.destroy=function(){_super.prototype.destroy.call(this);this.descriptionBuilder.destroy();this.descriptionBuilder=null;this.configuration=null};return DataAdapter}(Calendar.CalendarDataAdapter);Advanced.DataAdapter=DataAdapter})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var DescriptionBuilder=function(){function DescriptionBuilder(format,columns,htmlEncode){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(format))throw MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidInputParam,"format");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(columns))throw MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidInputParam,"columns");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(htmlEncode))throw MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidInputParam,"htmlEncode");this.columnMap=this.generateColumnMap(columns);this.formatTokens=this.parseFormatString(format);this.htmlEncode=htmlEncode}Object.defineProperty(DescriptionBuilder,"DescriptionComponentTemplate",{"get":function(){return '<p class="cc-adv-cal-description cc-adv-cal-description-{0}">{1}</p>'},enumerable:true,configurable:true});Object.defineProperty(DescriptionBuilder,"NonBreakingSpaceHtml",{"get":function(){return "&nbsp;"},enumerable:true,configurable:true});Object.defineProperty(DescriptionBuilder,"SpacerToken",{"get":function(){return "-"},enumerable:true,configurable:true});Object.defineProperty(DescriptionBuilder,"TokensDelimiter",{"get":function(){return /\s*,\s*/},enumerable:true,configurable:true});DescriptionBuilder.prototype.buildDescription=function(dataSetRecord){var _this=this,mainDescriptionFormattedString=this.getStringFormattedValue(dataSetRecord,Calendar.CalendarDataSetPropertyNames.DescriptionName),mainDescription=this.encodeComponent(mainDescriptionFormattedString,0),extraDescription=(new MscrmCommon.ArrayQuery(this.formatTokens)).select(function(token,index){var component;token=token.trim();if(_this.isSpacerToken(token))component=MscrmCommon.ControlUtils.String.Empty;else component=_this.getStringFormattedValue(dataSetRecord,token);return _this.encodeComponent(component,index+1)}).items().join(MscrmCommon.ControlUtils.String.Empty);return mainDescription+extraDescription};DescriptionBuilder.prototype.encodeComponent=function(text,index){var encodedText=!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(text)&&text!==DescriptionBuilder.NonBreakingSpaceHtml?MscrmCommon.ControlUtils.String.ReplaceLineBreaksWithBrTags(this.htmlEncode(text)):DescriptionBuilder.NonBreakingSpaceHtml;return MscrmCommon.ControlUtils.String.Format(DescriptionBuilder.DescriptionComponentTemplate,index,encodedText)};DescriptionBuilder.prototype.parseFormatString=function(format){var _this=this,tokens=format.split(DescriptionBuilder.TokensDelimiter);return (new MscrmCommon.ArrayQuery(tokens)).where(function(token){return _this.isSpacerToken(token)||_this.isValidColumnName(token)}).items()};DescriptionBuilder.prototype.getStringFormattedValue=function(dataSetRecord,columnAlias){var formattedValue=dataSetRecord.getFormattedValue(columnAlias);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(formattedValue))return Advanced.Constants.EmptyContentPlaceholder;else if(typeof formattedValue==="string")if(formattedValue.trim().length===0)return Advanced.Constants.EmptyContentPlaceholder;else return formattedValue;else if(typeof formattedValue==="object"){var typeName=this.getTypeName(formattedValue),obj;if(typeName===Advanced.Constants.EntityReferenceTypeName||typeName===Advanced.Constants.XrmEntityReferenceTypeName){var entityReferenceName=formattedValue.Name;return MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(entityReferenceName)?Advanced.Constants.EmptyContentPlaceholder:entityReferenceName}else return DescriptionBuilder.NonBreakingSpaceHtml}else return DescriptionBuilder.NonBreakingSpaceHtml};DescriptionBuilder.prototype.getTypeName=function(obj){if(typeof obj==="object"&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(obj.constructor)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(obj.constructor.__typeName))return obj.constructor.__typeName;else return null};DescriptionBuilder.prototype.isSpacerToken=function(token){return token.trim()===DescriptionBuilder.SpacerToken};DescriptionBuilder.prototype.isValidColumnName=function(columnName){return this.columnMap.hasOwnProperty(columnName.trim())};DescriptionBuilder.prototype.generateColumnMap=function(columns){var columnMap={};(new MscrmCommon.ArrayQuery(columns)).each(function(column){columnMap[column.name]=column});return columnMap};DescriptionBuilder.prototype.destroy=function(){this.columnMap=null;this.htmlEncode=null;this.formatTokens=null};return DescriptionBuilder}();Advanced.DescriptionBuilder=DescriptionBuilder})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var DhtmlxProxy=function(_super){__extends(DhtmlxProxy,_super);function DhtmlxProxy(schedulerControl,schedulerStaticConfig,containerId,configuration,eventManager,locale,formatterProvider,iconProvider,timeZoneConverter){this.configuration=configuration;this.locale=locale;this.formatterProvider=formatterProvider;_super.call(this,schedulerControl,schedulerStaticConfig,containerId,configuration,eventManager,locale,formatterProvider,iconProvider,timeZoneConverter)}DhtmlxProxy.prototype.initialize=function(){this.configureProxy();this.initializeProxy()};DhtmlxProxy.prototype.configureProxy=function(){_super.prototype.configureProxy.call(this);this.configureDisplayMode();this.configureEventRendering()};DhtmlxProxy.prototype.configureDisplayMode=function(){var container=$("#"+this.containerId);switch(this.configuration.displayMode){case Advanced.DisplayMode.StackedWithoutTimeline:this.configureStackedView();this.hideTimeline(container);break;case Advanced.DisplayMode.StackedWithDurationTimeline:this.configureStackedView();this.configureDurationTimeline();break}};DhtmlxProxy.prototype.configureStackedView=function(){this.schedulerControl.config.separate_short_events=false;this.schedulerControl.config.scroll_hour=23};DhtmlxProxy.prototype.hideTimeline=function(container){container.addClass(Advanced.Constants.StackedWithoutTimelineCssClass);this.schedulerControl.xy.scale_width=0};DhtmlxProxy.prototype.configureDurationTimeline=function(){var _this=this;this.schedulerControl.templates.hour_scale=this.formatterProvider.getDurationTimelineFormatter(this.configuration);var eventBarDateHandler=function(startDate,endDate,event){var icon=Calendar.DhtmlxProxy.iconProvider.generateThemedIcon(event,Calendar.DhtmlxProxy.getEntityColor(event.logicalName),false),time=$("<div/>");time.addClass("dhx_event_bar_date");time.text(_this.formatterProvider.formatDuration(_this.locale,event.calculateDurationInMinutes()));return $("<div />").append(icon,time).html()};this.schedulerControl.detachEvent(this.eventBarDateFormatHandlerId);this.eventBarDateFormatHandlerId=this.schedulerControl.attachEvent(Calendar.DhtmlxConstants.eventOnTemplatesReady,function(){_this.schedulerControl.templates.event_bar_date=eventBarDateHandler})};DhtmlxProxy.prototype.configureEventRendering=function(){var originalRenderEvent=this.schedulerControl.renderEvent;this.schedulerControl.renderEvent=function(container,item){var result=originalRenderEvent(container,item);container.style.borderColor=item.eventColor;return result}};DhtmlxProxy.prototype.triggerOnDateRangeChanged=function(){this.configuration.displayMode===Advanced.DisplayMode.StackedWithoutTimeline&&this.schedulerControl._reset_scale();_super.prototype.triggerOnDateRangeChanged.call(this)};DhtmlxProxy.prototype.destroy=function(){this.schedulerControl.detachEvent(this.eventBarDateFormatHandlerId);_super.prototype.destroy.call(this);this.eventBarDateFormatHandlerId=null;this.schedulerControl=null;this.containerId=null;this.configuration=null;this.locale=null;this.formatterProvider=null};return DhtmlxProxy}(Calendar.DhtmlxProxy);Advanced.DhtmlxProxy=DhtmlxProxy})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var FormatterProvider=function(_super){__extends(FormatterProvider,_super);function FormatterProvider(formatInteger){_super.call(this);this.formatInteger=formatInteger}FormatterProvider.prototype.getDurationTimelineFormatter=function(configuration){var _this=this;return function(date){return _this.formatInteger(24-date.getHours())}};FormatterProvider.prototype.formatDuration=function(locale,durationInMinutes){var hours=Math.floor(durationInMinutes/60),minutes=Math.floor(durationInMinutes%60);if(hours>0)return MscrmCommon.ControlUtils.String.Format(locale.hoursAndMinutesDurationFormat,this.formatInteger(hours),this.formatInteger(minutes));else return MscrmCommon.ControlUtils.String.Format(locale.minutesDurationFormat,this.formatInteger(minutes))};FormatterProvider.prototype.dateToStringExtended=function(originalDateToString,configuration){var _this=this;return function(format){if(MscrmCommon.ControlUtils.String.EqualsIgnoreCase(format,Advanced.WebixConstants.StackedWithDurationTimelineCustomFormat))return _this.getDurationTimelineFormatter(configuration);else return _super.prototype.dateToStringExtended.call(_this,originalDateToString,configuration)(format)}};return FormatterProvider}(Calendar.FormatterProvider);Advanced.FormatterProvider=FormatterProvider})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var Item=function(_super){__extends(Item,_super);function Item(){_super.apply(this,arguments)}Item.prototype.calculateDurationInMinutes=function(){var hasDataSetStartDate=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.dataSetRecordStartDate),hasDataSetEndDate=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.dataSetRecordEndDate),hasDataSetDuration=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.dataSetRecordDuration);if(hasDataSetStartDate&&hasDataSetEndDate){var durationInMiliseconds=this.dataSetRecordEndDate.getTime()-this.dataSetRecordStartDate.getTime();return Math.round(durationInMiliseconds/6e4)}else if(hasDataSetDuration)return this.dataSetRecordDuration;else return 0};return Item}(Calendar.CalendarItem);Advanced.Item=Item})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var LabelId=function(_super){__extends(LabelId,_super);function LabelId(){_super.apply(this,arguments)}LabelId.minutesDurationFormat="CC_AdvancedCalendar_MinutesDurationFormat";LabelId.hoursAndMinutesDurationFormat="CC_AdvancedCalendar_HoursAndMinutesDurationFormat";return LabelId}(Calendar.LabelId);Advanced.LabelId=LabelId})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var Locale=function(_super){__extends(Locale,_super);function Locale(){_super.apply(this,arguments)}return Locale}(Calendar.CalendarLocale);Advanced.Locale=Locale})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var WebixProxy=function(_super){__extends(WebixProxy,_super);function WebixProxy(webixScheduler,webix,containerId,eventManager,locale,configuration,formatterProvider,iconProvider,timeZoneConverter){this.configuration=configuration;WebixProxy.formatterProvider=formatterProvider;WebixProxy.locale=locale;_super.call(this,webixScheduler,webix,containerId,eventManager,locale,configuration,formatterProvider,iconProvider,timeZoneConverter)}WebixProxy.prototype.initialize=function(){this.configureProxy();this.initializeProxy()};WebixProxy.prototype.configureProxy=function(){_super.prototype.configureProxy.call(this);this.configureTimeline()};WebixProxy.prototype.initializeProxy=function(){var _this=this;_super.prototype.initializeProxy.call(this);this.webix.ready(function(){_this.setupScrollHandler()})};WebixProxy.prototype.configureTimeline=function(){var container=$("#"+this.containerId);this.configureStaticDefaults();switch(this.configuration.displayMode){case Advanced.DisplayMode.StackedWithoutTimeline:this.configureStackedWithoutTimelineDisplayMode(container);break;case Advanced.DisplayMode.StackedWithDurationTimeline:this.configureStackedWithDurationDisplayMode();break}};WebixProxy.prototype.configureStaticDefaults=function(){this.webixScheduler.xy.scale_width=40;this.webixScheduler.config.scale_hour=this.formatterProvider.getScaleTimeFormatPattern(this.configuration)};WebixProxy.prototype.configureStackedWithoutTimelineDisplayMode=function(container){container.addClass(Advanced.Constants.StackedWithoutTimelineCssClass);this.webixScheduler.xy.scale_width=0};WebixProxy.prototype.configureStackedWithDurationDisplayMode=function(){this.webixScheduler.config.scale_hour=Advanced.WebixConstants.StackedWithDurationTimelineCustomFormat};WebixProxy.prototype.setupScrollHandler=function(){var _this=this,scheduler=this.webix.$$(this.schedulerId);this.attachEvent(scheduler.$$(Calendar.WebixConstants.viewChangeButtonsId),Calendar.WebixConstants.onAfterTabClick,function(buttonId){buttonId===Calendar.WebixConstants.dayViewButtonId&&_this.scrollDayView()});Advanced.DisplayModeUtil.isStackedDisplayMode(this.configuration.displayMode)&&this.attachEvent(scheduler,Advanced.WebixConstants.OnAfterLoad,function(){var multiDayEventsContainerSelector=MscrmCommon.ControlUtils.String.Format("#{0} {1}",_this.containerId,Advanced.WebixConstants.MultiDayEventsContainerSelector),hasMultiDayEvents=$(multiDayEventsContainerSelector).height()>1;hasMultiDayEvents&&_this.scrollDayView()})};WebixProxy.dayEventStyleTemplate=function(item){return "border-color:"+item.eventColor+";"};WebixProxy.prototype.showCalendarItems=function(calendarItems){var _this=this;this.webix.ready(function(){var scheduler=_this.webix.$$(_this.schedulerId);if(calendarItems.length!==0)scheduler.parse(calendarItems,"json");else scheduler.clearAll()})};WebixProxy.prototype.onActivationChanged=function(isActive){_super.prototype.onActivationChanged.call(this,isActive);isActive&&this.scrollDayView()};WebixProxy.prototype.triggerFirstOnDateRangeChanged=function(){this.scrollDayView();_super.prototype.triggerFirstOnDateRangeChanged.call(this)};WebixProxy.prototype.triggerOnDateRangeChanged=function(startDate,endDate){this.configuration.displayMode===Advanced.DisplayMode.StackedWithoutTimeline&&this.scrollDayView();_super.prototype.triggerOnDateRangeChanged.call(this,startDate,endDate)};WebixProxy.prototype.scrollDayView=function(){var scheduler=this.webix.$$(this.schedulerId),dayView=scheduler.$$(Calendar.WebixConstants.dayListId),hourToScrollTo=Advanced.DisplayModeUtil.isStackedDisplayMode(this.configuration.displayMode)?24:(new Date).getHours(),scrollLeft=0,scrollTop=hourToScrollTo*dayView.config.timeScaleHeight;if(this.configuration.userAgent&&this.configuration.userAgent.isWinPhone10)this.scrollToInWin10Phone(dayView,scrollLeft,scrollTop);else dayView.scrollTo(scrollLeft,scrollTop)};WebixProxy.prototype.scrollToInWin10Phone=function(dayView,left,top){dayView.y.parentNode.scrollLeft=left;dayView.y.parentNode.scrollTop=top};WebixProxy.prototype.destroy=function(){_super.prototype.destroy.call(this);this.webixScheduler=null;this.containerId=null;this.configuration=null};return WebixProxy}(Calendar.WebixProxy);Advanced.WebixProxy=WebixProxy;var eventId=webix.attachEvent("onBeforeSchedulerInit",function(){var originalEventTimeTemplate=scheduler.templates.event_time;scheduler.templates.event_time=function(event){if(event.displayMode===Advanced.DisplayMode.StackedWithDurationTimeline)return WebixProxy.formatterProvider.formatDuration(WebixProxy.locale,event.calculateDurationInMinutes());else return originalEventTimeTemplate.apply(null,arguments)}});Calendar.WebixProxy.detachStaticHandlerActions.push(function(){return webix.detachEvent(eventId)});var originalDayEventStyleTemplate=Calendar.WebixProxy.dayEventStyleTemplate;Calendar.WebixProxy.dayEventStyleTemplate=function(obj){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(obj.eventColor))return Advanced.WebixProxy.dayEventStyleTemplate(obj);else return originalDayEventStyleTemplate.apply(null,arguments)}})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";(function(ColorFallbackBehavior){ColorFallbackBehavior[ColorFallbackBehavior["ColorFromEntity"]=0]="ColorFromEntity";ColorFallbackBehavior[ColorFallbackBehavior["ColorFromFirstOptionSet"]=1]="ColorFromFirstOptionSet"})(Advanced.ColorFallbackBehavior||(Advanced.ColorFallbackBehavior={}));var ColorFallbackBehavior=Advanced.ColorFallbackBehavior,ColorFallbackBehaviorUtil=function(){function ColorFallbackBehaviorUtil(){}Object.defineProperty(ColorFallbackBehaviorUtil,"ColorFromEntity",{"get":function(){return "colorfromentity"},enumerable:true,configurable:true});Object.defineProperty(ColorFallbackBehaviorUtil,"ColorFromFirstOptionSet",{"get":function(){return "colorfromfirstoptionset"},enumerable:true,configurable:true});ColorFallbackBehaviorUtil.parseValue=function(value){var value=value.toLowerCase();switch(value){case ColorFallbackBehaviorUtil.ColorFromEntity:return ColorFallbackBehavior.ColorFromEntity;case ColorFallbackBehaviorUtil.ColorFromFirstOptionSet:return ColorFallbackBehavior.ColorFromFirstOptionSet;default:return null}};return ColorFallbackBehaviorUtil}();Advanced.ColorFallbackBehaviorUtil=ColorFallbackBehaviorUtil})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";(function(DisplayMode){DisplayMode[DisplayMode["AnchoredWithHoursOfTheDayTimeline"]=0]="AnchoredWithHoursOfTheDayTimeline";DisplayMode[DisplayMode["StackedWithoutTimeline"]=1]="StackedWithoutTimeline";DisplayMode[DisplayMode["StackedWithDurationTimeline"]=2]="StackedWithDurationTimeline"})(Advanced.DisplayMode||(Advanced.DisplayMode={}));var DisplayMode=Advanced.DisplayMode,DisplayModeUtil=function(){function DisplayModeUtil(){}Object.defineProperty(DisplayModeUtil,"AnchoredWithHoursOfTheDayTimelineString",{"get":function(){return "anchoredwithhoursofthedaytimeline"},enumerable:true,configurable:true});Object.defineProperty(DisplayModeUtil,"StackedWithoutTimelineString",{"get":function(){return "stackedwithouttimeline"},enumerable:true,configurable:true});Object.defineProperty(DisplayModeUtil,"StackedWithDurationTimelineString",{"get":function(){return "stackedwithdurationtimeline"},enumerable:true,configurable:true});DisplayModeUtil.parseValue=function(value){var value=value.toLowerCase();switch(value){case DisplayModeUtil.AnchoredWithHoursOfTheDayTimelineString:return DisplayMode.AnchoredWithHoursOfTheDayTimeline;case DisplayModeUtil.StackedWithoutTimelineString:return DisplayMode.StackedWithoutTimeline;case DisplayModeUtil.StackedWithDurationTimelineString:return DisplayMode.StackedWithDurationTimeline;default:return null}};DisplayModeUtil.isStackedDisplayMode=function(value){return value==DisplayMode.StackedWithDurationTimeline||value==DisplayMode.StackedWithoutTimeline};return DisplayModeUtil}();Advanced.DisplayModeUtil=DisplayModeUtil})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var ColorProvider=function(){function ColorProvider(configuration){this.configuration=configuration}ColorProvider.prototype.calculateItemColor=function(dataSetRecord){var validPrimaryColor=this.extractValidColor(dataSetRecord,this.configuration.primaryColorColumnName,this.configuration.primaryColorOptions);if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(validPrimaryColor))return validPrimaryColor;var validSecondaryColor=this.extractValidColor(dataSetRecord,this.configuration.secondaryColorColumnName,this.configuration.secondaryColorOptions);if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(validSecondaryColor))return validSecondaryColor;return this.configuration.getEntityColor(dataSetRecord.getPrimaryEntityLogicalName())};ColorProvider.prototype.extractValidColor=function(dataSetRecord,colorColumnName,colorOptions){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(colorOptions))return null;var colorOption=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(colorColumnName)?dataSetRecord.getValue(colorColumnName):null,color=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(colorOption)?colorOptions[colorOption]:null;return this.isValidColor(color)?color:null};ColorProvider.prototype.isValidColor=function(color){try{MscrmCommon.ThemingHelper.validateCssColor(color);return true}catch(e){return false}};ColorProvider.prototype.destroy=function(){};return ColorProvider}();Advanced.ColorProvider=ColorProvider})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var ConfigurationFactory=function(_super){__extends(ConfigurationFactory,_super);function ConfigurationFactory(){_super.apply(this,arguments)}ConfigurationFactory.prototype.create=function(configBag,timeZoneConverter,calendarState){var _this=this,calendarConfiguration=_super.prototype.create.call(this,configBag,timeZoneConverter,calendarState),configuration=new Advanced.Configuration,hasParameters=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(configBag.parameters),displayModeProperty=hasParameters?configBag.parameters.DisplayMode:null,minimumDurationProperty=hasParameters?configBag.parameters.MinimumDuration:null,extraDescriptionFormatProperty=hasParameters?configBag.parameters.ExtraDescriptionFormat:null,colorFallbackBehaviorProperty=hasParameters?configBag.parameters.ColorFallbackBehavior:null;configuration.displayMode=this.parsePropertyOrDefault(displayModeProperty,Advanced.DisplayModeUtil.parseValue,Advanced.DisplayMode.AnchoredWithHoursOfTheDayTimeline);configuration.itemMinDuration=this.parsePropertyOrDefault(minimumDurationProperty,function(num){return _this.parseBoundedInt(num,30)},30);configuration.extraDescriptionFormat=this.parsePropertyOrDefault(extraDescriptionFormatProperty,function(s){return s},MscrmCommon.ControlUtils.String.Empty);if(hasParameters){var colorFallbackBehavior=this.parsePropertyOrDefault(colorFallbackBehaviorProperty,Advanced.ColorFallbackBehaviorUtil.parseValue,Advanced.ColorFallbackBehavior.ColorFromEntity);this.retrieveColorOptions(configBag.parameters.Calendar,configuration,colorFallbackBehavior)}configuration.formatInteger=configBag.formatting.formatInteger.bind(configBag.formatting);configuration.shortDateFormatter=calendarConfiguration.shortDateFormatter;configuration.formatDateLongAbbreviated=calendarConfiguration.formatDateLongAbbreviated;configuration.longDateFormatter=calendarConfiguration.longDateFormatter;configuration.yearMonthDateFormatter=calendarConfiguration.yearMonthDateFormatter;configuration.shortTimePattern=calendarConfiguration.shortTimePattern;configuration.timeSeparator=calendarConfiguration.timeSeparator;configuration.showWeekNumbers=calendarConfiguration.showWeekNumbers;configuration.weekNumberCalculator=calendarConfiguration.weekNumberCalculator;configuration.weekStartsOnMonday=calendarConfiguration.weekStartsOnMonday;configuration.pageSize=calendarConfiguration.pageSize;configuration.theme=calendarConfiguration.theme;configuration.getEntityColor=calendarConfiguration.getEntityColor;configuration.amDesignator=calendarConfiguration.amDesignator;configuration.pmDesignator=calendarConfiguration.pmDesignator;configuration.selectedDate=calendarConfiguration.selectedDate;configuration.selectedView=calendarConfiguration.selectedView;configuration.userAgent=calendarConfiguration.userAgent;return configuration};ConfigurationFactory.prototype.parsePropertyOrDefault=function(property,parser,defaultValue){var parsed;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(property))parsed=parser(property.raw);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(parsed))parsed=defaultValue;return parsed};ConfigurationFactory.prototype.parseBoundedInt=function(num,lowerLimit){return num>=lowerLimit?num:null};ConfigurationFactory.prototype.retrieveColorOptions=function(dataSet,configuration,colorFallbackBehavior){var _this=this;dataSet.generateAdditionalAttributes().done(function(){var primaryColorColumn=_this.findFirstOptionColorColumn(dataSet.columns),secondaryColorColumn=_this.findSecondOptionColorColumn(dataSet.columns,colorFallbackBehavior);if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(primaryColorColumn)){configuration.primaryColorColumnName=primaryColorColumn.name;configuration.primaryColorOptions=_this.extractColorOptions(primaryColorColumn.attributes)}if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(secondaryColorColumn)){configuration.secondaryColorColumnName=secondaryColorColumn.name;configuration.secondaryColorOptions=_this.extractColorOptions(secondaryColorColumn.attributes)}})};ConfigurationFactory.prototype.findFirstOptionColorColumn=function(columns){var _this=this,colorColumn=(new MscrmCommon.ArrayQuery(columns)).firstOrDefault(function(column){return column.alias===Calendar.CalendarDataSetPropertyNames.ColorName&&_this.isOptionSetColumnWithOptions(column)});return colorColumn};ConfigurationFactory.prototype.findSecondOptionColorColumn=function(columns,colorFallbackBehavior){var colorColumn;if(colorFallbackBehavior===Advanced.ColorFallbackBehavior.ColorFromFirstOptionSet){var validColumns=columns.filter(function(column){return column.order!=-1});validColumns.sort(function(a,b){return a.order-b.order});colorColumn=(new MscrmCommon.ArrayQuery(validColumns)).firstOrDefault(this.isOptionSetColumnWithOptions)}return colorColumn};ConfigurationFactory.prototype.extractColorOptions=function(colorColumnAttributes){var colorOptions={};(new MscrmCommon.ArrayQuery(colorColumnAttributes.options)).select(function(option){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(option.Value))colorOptions[option.Value]=option.Color});return colorOptions};ConfigurationFactory.prototype.isOptionSetColumnWithOptions=function(column){return column.dataType.toLowerCase()===Advanced.Constants.OptionSetDataType.toLowerCase()&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(column.attributes.options)};return ConfigurationFactory}(Calendar.CalendarConfigurationFactory);Advanced.ConfigurationFactory=ConfigurationFactory})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var ControlManagerFactory=function(){function ControlManagerFactory(){}ControlManagerFactory.prototype.create=function(controlType,containerId,calendarConfigurationBag,calendarState,timeZoneConverter){var configuration=(new Advanced.ConfigurationFactory).create(calendarConfigurationBag,timeZoneConverter,calendarState),locale=(new Advanced.LocaleProvider(calendarConfigurationBag.resources.getString,calendarConfigurationBag.client.dateFormattingInfo)).get(),filterManagerFactory=new Calendar.FilterManagerFactory(timeZoneConverter,calendarConfigurationBag.formatting.formatDateAsFilterStringInUTC,configuration.itemMinDuration),controlProxy=(new Advanced.ControlProxyFactory(controlType,containerId,configuration,locale,timeZoneConverter)).create(),navigateEdit=calendarConfigurationBag.navigation.openEditForm,descriptionBuilder=new Advanced.DescriptionBuilder(configuration.extraDescriptionFormat,calendarConfigurationBag.parameters.Calendar.columns,calendarConfigurationBag.utils.crmHtmlEncode),colorProvider=new Advanced.ColorProvider(configuration),dataAdapter=new Advanced.DataAdapter(calendarConfigurationBag.utils.crmHtmlEncode,configuration.itemMinDuration,timeZoneConverter,configuration,descriptionBuilder,colorProvider);return new Calendar.CalendarControlManager(controlProxy,dataAdapter,navigateEdit,filterManagerFactory,configuration.pageSize,calendarConfigurationBag)};return ControlManagerFactory}();Advanced.ControlManagerFactory=ControlManagerFactory})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var ControlProxyFactory=function(){function ControlProxyFactory(controlType,containerId,configuration,locale,timeZoneConverter){this.controlType=controlType;this.containerId=containerId;this.configuration=configuration;this.locale=locale;this.timeZoneConverter=timeZoneConverter;this.webixControl=webix;this.dhtmlxSchedulerFactory=Scheduler;this.schedulerStatic=scheduler}ControlProxyFactory.prototype.create=function(){var formatterProvider=new Advanced.FormatterProvider(this.configuration.formatInteger),eventManager=new Calendar.EventManager,iconProvider=new Advanced.IconProvider;switch(this.controlType){case Calendar.CalendarControlType.Webix:return new Advanced.WebixProxy(this.schedulerStatic,this.webixControl,this.containerId,eventManager,this.locale,this.configuration,formatterProvider,iconProvider,this.timeZoneConverter);case Calendar.CalendarControlType.Dhtmlx:return new Advanced.DhtmlxProxy(this.dhtmlxSchedulerFactory.getSchedulerInstance(),this.schedulerStatic,this.containerId,this.configuration,eventManager,this.locale,formatterProvider,iconProvider,this.timeZoneConverter);default:throw new Error("The control type is not supported")}};return ControlProxyFactory}();Advanced.ControlProxyFactory=ControlProxyFactory})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var LocaleProvider=function(){function LocaleProvider(getString,dateFormattingInfo){this.getString=getString;this.calendarLocaleProvider=new Calendar.CalendarLocaleProvider(getString,dateFormattingInfo)}LocaleProvider.prototype.get=function(){var calendarLocale=this.calendarLocaleProvider.get(),locale=new Advanced.Locale;locale.minutesDurationFormat=this.getString(Advanced.LabelId.minutesDurationFormat);locale.hoursAndMinutesDurationFormat=this.getString(Advanced.LabelId.hoursAndMinutesDurationFormat);locale.allDayItemLabel=calendarLocale.allDayItemLabel;locale.dayViewLabel=calendarLocale.dayViewLabel;locale.monthViewLabel=calendarLocale.monthViewLabel;locale.todayLabel=calendarLocale.todayLabel;locale.weekViewLabel=calendarLocale.weekViewLabel;locale.errorViewDefaultErrorMessageLabel=calendarLocale.errorViewDefaultErrorMessageLabel;locale.viewMoreLabel=calendarLocale.viewMoreLabel;locale.dayFullLabels=calendarLocale.dayFullLabels;locale.dayShortLabels=calendarLocale.dayShortLabels;locale.monthFullLabels=calendarLocale.monthFullLabels;locale.monthShortLabels=calendarLocale.monthShortLabels;return locale};return LocaleProvider}();Advanced.LocaleProvider=LocaleProvider})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var IconProvider=function(_super){__extends(IconProvider,_super);function IconProvider(){_super.apply(this,arguments)}IconProvider.prototype.generateThemedIcon=function(item,entityColor,styleForWebix,additionalClass){var iconContainer=_super.prototype.generateThemedIcon.call(this,item,entityColor,styleForWebix,additionalClass),iconContainerStyle={"background-color":item.eventColor,"border-color":item.eventColor};return iconContainer.css(iconContainerStyle)};return IconProvider}(Calendar.IconProvider);Advanced.IconProvider=IconProvider})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict"})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict"})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict"})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict"})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict"})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Calendar;(function(Calendar){var Advanced;(function(Advanced){"use strict";var Constants=function(){function Constants(){}Object.defineProperty(Constants,"StackedWithoutTimelineCssClass",{"get":function(){return "cc-adv-cal-stacked-without-timeline"},enumerable:true,configurable:true});Object.defineProperty(Constants,"OptionSetDataType",{"get":function(){return "OptionSet"},enumerable:true,configurable:true});Object.defineProperty(Constants,"EmptyContentPlaceholder",{"get":function(){return "---"},enumerable:true,configurable:true});Object.defineProperty(Constants,"EntityReferenceTypeName",{"get":function(){return "Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityReference"},enumerable:true,configurable:true});Object.defineProperty(Constants,"XrmEntityReferenceTypeName",{"get":function(){return "Xrm.Objects.EntityReference"},enumerable:true,configurable:true});return Constants}();Advanced.Constants=Constants})(Advanced=Calendar.Advanced||(Calendar.Advanced={}))})(Calendar=MscrmControls.Calendar||(MscrmControls.Calendar={}))})(MscrmControls||(MscrmControls={}))