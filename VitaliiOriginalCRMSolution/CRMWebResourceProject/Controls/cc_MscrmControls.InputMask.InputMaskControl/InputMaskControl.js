/** @license Copyright (c) Microsoft Corporation. All rights reserved. */
var MscrmControls;(function(MscrmControls){var InputMask;(function(InputMask){"use strict";var WijmoCultureHelper=function(){function WijmoCultureHelper(){}WijmoCultureHelper.prototype.backupCurrentCulture=function(){this.isCurrentCultureSaved=false;this.decimalSeparatorInCurrentCulture=wijmo.culture.Globalize.numberFormat[WijmoCultureHelper.decimalSeparatorEnUS];this.groupSeparatorInCurrentCulture=wijmo.culture.Globalize.numberFormat[WijmoCultureHelper.groupSeparatorEnUS];this.currencySymbolInCurrentCulture=wijmo.culture.Globalize.numberFormat.currency.symbol;this.dateSeparatorInCurrentCulture=wijmo.culture.Globalize.calendar[WijmoCultureHelper.dateSeparatorEnUS];this.timeSeparatorInCurrentCulture=wijmo.culture.Globalize.calendar[WijmoCultureHelper.timeSeparatorEnUS];this.isCurrentCultureSaved=true};WijmoCultureHelper.prototype.setInvariantCulture=function(){this.setCulture(WijmoCultureHelper.decimalSeparatorEnUS,WijmoCultureHelper.groupSeparatorEnUS,WijmoCultureHelper.currencySymbolEnUS,WijmoCultureHelper.dateSeparatorEnUS,WijmoCultureHelper.timeSeparatorEnUS)};WijmoCultureHelper.prototype.restoreOriginalCulture=function(){this.isCurrentCultureSaved&&this.setCulture(this.decimalSeparatorInCurrentCulture,this.groupSeparatorInCurrentCulture,this.currencySymbolInCurrentCulture,this.dateSeparatorInCurrentCulture,this.timeSeparatorInCurrentCulture)};WijmoCultureHelper.prototype.setCulture=function(decimalSeparator,groupSeparator,currencySymbol,dateSeparator,timeSeparator){wijmo.culture.Globalize.numberFormat[WijmoCultureHelper.decimalSeparatorEnUS]=decimalSeparator;wijmo.culture.Globalize.numberFormat[WijmoCultureHelper.groupSeparatorEnUS]=groupSeparator;wijmo.culture.Globalize.numberFormat.currency.symbol=currencySymbol;wijmo.culture.Globalize.calendar[WijmoCultureHelper.dateSeparatorEnUS]=dateSeparator;wijmo.culture.Globalize.calendar[WijmoCultureHelper.timeSeparatorEnUS]=timeSeparator};WijmoCultureHelper.decimalSeparatorEnUS=".";WijmoCultureHelper.groupSeparatorEnUS=",";WijmoCultureHelper.currencySymbolEnUS="$";WijmoCultureHelper.dateSeparatorEnUS="/";WijmoCultureHelper.timeSeparatorEnUS=":";return WijmoCultureHelper}();InputMask.WijmoCultureHelper=WijmoCultureHelper})(InputMask=MscrmControls.InputMask||(MscrmControls.InputMask={}))})(MscrmControls||(MscrmControls={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}__.prototype=b.prototype;d.prototype=new __},MscrmControls;(function(MscrmControls){var InputMask;(function(InputMask_1){"use strict";var ExceptionHandler=MscrmCommon.ErrorHandling.ExceptionHandler,Utils=MscrmCommon.ControlUtils,InputMaskControl=function(_super){__extends(InputMaskControl,_super);function InputMaskControl(){_super.call(this);this.preventEditModePanoramaEvents=true;this.maskChanged=false}InputMaskControl.prototype.initCore=function(context){var _this=this;this.inputMaskControl=this.createControlOnDOM();this.inputMaskControl.valueChanged.addHandler(function(){return _this.notifyEnabledControlOutputChanged.apply(_this)});this.invalidInputMessageFormat=context.resources.getString(MscrmCommon.ErrorHandling.ErrorCode.InvalidInputMaskId);this.inputMaskControl.hostElement.classList.add(InputMaskControl.CustomWrapperClassName);this.buildAndInjectCustomStyle(context.theming)};InputMaskControl.prototype.updateCore=function(context){var _this=this;this.throwIfPropertyBagParametersNotValid(context);if(!this.maskChanged)this.backupValue=this.inputMaskControl.value;var value=Utils.Object.isNullOrUndefined(context.parameters.value.raw)?Utils.String.Empty:context.parameters.value.raw,mask=Utils.Object.isNullOrUndefined(context.parameters.mask.raw)?Utils.String.Empty:context.parameters.mask.raw;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.inputMaskControl.mask)&&mask!==this.inputMaskControl.mask){this.handleMaskChanged(mask);return}if(!this.validateMaskedValue())return;if(this.inputMaskControl.value===value&&this.inputMaskControl.mask===mask)return;this.inputMaskControl.valueChanged.removeAllHandlers();this.inputMaskControl.value=value;this.inputMaskControl.mask=mask;this.inputMaskControl.value=this.inputMaskControl._maskProvider._applyMask();this.ignoreLocalizedSymbols();this.backupValue=this.inputMaskControl.value;this.inputMaskControl.valueChanged.addHandler(function(){return _this.notifyEnabledControlOutputChanged.apply(_this)})};InputMaskControl.prototype.renderReadMode=function(context){_super.prototype.renderReadMode.call(this,context);$(this.valueContainer).text(this.backupValue);$(this.valueContainer).show();$(this.controlWrapperContainer).hide();this.eventGuard.stopPreventingFocus()};InputMaskControl.prototype.renderEditMode=function(context){_super.prototype.renderEditMode.call(this,context);$(this.valueContainer).hide();$(this.controlWrapperContainer).show();this.inputMaskControl.hostElement.classList.remove(MscrmCommon.ThemingHelper.ReadModeClassName);this.inputMaskControl.disabled=false;this.shouldNotifyOutputChanged=true;if(this.maskChanged){this.notifyEnabledControlOutputChanged();this.maskChanged=false}this.focusInputElement(context.client.userAgent)};InputMaskControl.prototype.getOutputsCore=function(){this.validateMaskedValue();var result={value:this.inputMaskControl.rawValue};this.backupValue=this.inputMaskControl.value;return result};InputMaskControl.prototype.destroyCore=function(){if(this.isControlInitialized){this.inputMaskControl.valueChanged.removeAllHandlers();this.inputMaskControl.dispose()}this.inputMaskControl=null;$(this.container).empty()};InputMaskControl.prototype.notifyEnabledControlOutputChanged=function(){this.inputMaskControl._maskProvider._applyMask();if(!this.isValidMaskedValue())return;_super.prototype.notifyEnabledControlOutputChanged.call(this)};InputMaskControl.prototype.showDefaultLabelCore=function(context){this.eventGuard.stopPreventingFocus();return MscrmCommon.ControlUtils.Property.isNullOrEmpty(context.parameters.value)&&MscrmCommon.ControlUtils.String.isNullOrEmpty(this.inputMaskControl.rawValue)};InputMaskControl.prototype.throwIfPropertyBagParametersNotValid=function(context){Utils.Object.isNullOrUndefined(context.parameters.value)&&ExceptionHandler.throwException(Utils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"value"));Utils.Object.isNullOrUndefined(context.parameters.mask)&&ExceptionHandler.throwException(Utils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"mask"))};InputMaskControl.prototype.handleMaskChanged=function(newMask){this.inputMaskControl.mask=newMask;var isValidMask=this.inputMaskControl.maskFull&&this.backupValue.length===this.inputMaskControl.value.length,isNewMaskEmpty=Utils.String.isNullOrWhitespace(newMask);if(!isNewMaskEmpty&&!isValidMask)this.notifyInvalidInputMask();else this.notificationHandler.clear(MscrmCommon.ErrorHandling.ErrorCode.InvalidInputMaskId);this.maskChanged=true};InputMaskControl.prototype.ignoreLocalizedSymbols=function(){var wijmoCultureHelper=new MscrmControls.InputMask.WijmoCultureHelper;wijmoCultureHelper.backupCurrentCulture();try{wijmoCultureHelper.setInvariantCulture();this.inputMaskControl.refresh()}catch(e){ExceptionHandler.throwException(InputMaskControl.CultureSettingOrRefreshFailed)}finally{wijmoCultureHelper.restoreOriginalCulture()}};InputMaskControl.prototype.validateMaskedValue=function(){this.notificationHandler.clear(MscrmCommon.ErrorHandling.ErrorCode.InvalidInputMaskId);if(this.isValidMaskedValue())return true;this.notifyInvalidInputMask();return false};InputMaskControl.prototype.isValidMaskedValue=function(){return this.inputMaskControl.maskFull||Utils.String.isNullOrEmpty(this.inputMaskControl.rawValue)};InputMaskControl.prototype.notifyInvalidInputMask=function(){var message=Utils.String.Format(this.invalidInputMessageFormat,this.inputMaskControl.mask);this.notificationHandler.notify(message,MscrmCommon.ErrorHandling.ErrorCode.InvalidInputMaskId)};InputMaskControl.prototype.setCursor=function(){var inputElement=this.inputMaskControl.inputElement;if(Utils.String.isNullOrEmpty(this.inputMaskControl.rawValue))inputElement.setSelectionRange(-1,-1);else{var cursorEnd=this.inputMaskControl.value.length;inputElement.setSelectionRange(cursorEnd,cursorEnd)}};InputMaskControl.prototype.focusInputElement=function(userAgent){var _this=this,inputElement=this.inputMaskControl.inputElement;if(userAgent.isAndroid)this.setCursor();else{setTimeout(function(){_this.eventGuard.stopPreventingFocus();inputElement.blur();_this.setCursor()},InputMaskControl.FocusTimeoutMs);this.eventGuard.preventEditModeTransitionFocus()}};InputMaskControl.prototype.createControlOnDOM=function(){this.controlWrapperContainer=_super.prototype.createWrapperContainer.call(this);return new wijmo.input.InputMask(this.controlWrapperContainer)};InputMaskControl.prototype.buildAndInjectCustomStyle=function(theming){var fontfamily=MscrmCommon.ThemingHelper.getFontFamily(theming),fontcolor=MscrmCommon.ThemingHelper.getFontColor(theming),styleFormat=".crm-wijmo-inputmask.wj-content input {\t\t\t\t\tfont-family: {0};\t\t\t\t\t-webkit-text-fill-color: {1};\t\t\t\t\tcolor : {1};\t\t\t\t}",customThemeClass=MscrmCommon.ControlUtils.String.Format(styleFormat,fontfamily,fontcolor);MscrmCommon.ThemingHelper.injectStyle(this.container,customThemeClass)};InputMaskControl.InvalidInputParamMask="The mask input parameter is invalid.";InputMaskControl.CultureSettingOrRefreshFailed="The culture setting or refresh function failed";InputMaskControl.FocusTimeoutMs=400;InputMaskControl.CustomWrapperClassName="crm-wijmo-inputmask";return InputMaskControl}(MscrmCommon.FieldControlBase);InputMask_1.InputMaskControl=InputMaskControl})(InputMask=MscrmControls.InputMask||(MscrmControls.InputMask={}))})(MscrmControls||(MscrmControls={}))