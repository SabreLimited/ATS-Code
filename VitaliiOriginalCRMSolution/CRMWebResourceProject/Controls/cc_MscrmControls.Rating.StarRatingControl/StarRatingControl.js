/** @license Copyright (c) Microsoft Corporation. All rights reserved. */
var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}__.prototype=b.prototype;d.prototype=new __},MscrmControls;(function(MscrmControls){var Rating;(function(Rating){"use strict";var CrmRating=function(_super){__extends(CrmRating,_super);function CrmRating(){_super.apply(this,arguments)}CrmRating.prototype._ensureTooltips=function(){return};CrmRating.prototype._openTooltip=function(tooltipType){return};CrmRating.prototype._closeTooltip=function(){return};return CrmRating}(WinJS.UI.Rating);Rating.CrmRating=CrmRating})(Rating=MscrmControls.Rating||(MscrmControls.Rating={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var Rating;(function(Rating){"use strict";var ExceptionHandler=MscrmCommon.ErrorHandling.ExceptionHandler,StarRatingControl=function(_super){__extends(StarRatingControl,_super);function StarRatingControl(){_super.call(this);this.preventEditModePanoramaEvents=true}StarRatingControl.prototype.initCore=function(context){var _this=this;this.rating=new Rating.CrmRating;$(this.container).append(this.rating.element);var theme=StarRatingControl.buildTheme(context.theming);MscrmCommon.ThemingHelper.injectStyle(this.container,theme);this.updateCallback=function(){_this.notifyOutputChanged()};WinJS.UI.eventHandler(this.updateCallback);this.rating.addEventListener(MscrmCommon.EventConstants.Change,this.updateCallback,false)};StarRatingControl.prototype.updateCore=function(context){this.throwIfPropertyBagParametersNotValid(context);this.updateValues(context);$(this.valueContainer).hide()};StarRatingControl.prototype.renderReadMode=function(context){_super.prototype.renderReadMode.call(this,context);context.theming.inlineLayout(true);this.rating.disabled=true;this.setReadMode(context.mode.isRead||context.mode.isPreview);this.setDisabledMode(context.mode.isControlDisabled)};StarRatingControl.prototype.renderEditMode=function(context){_super.prototype.renderEditMode.call(this,context);this.rating.disabled=false;this.setReadMode(false);this.setDisabledMode(false);context.theming.rightAlignEdit();this.shouldNotifyOutputChanged=true};StarRatingControl.prototype.getOutputsCore=function(){var outputs={value:this.rating.userRating};return outputs};StarRatingControl.prototype.destroyCore=function(){if(this.isControlInitialized){this.rating.removeEventListener(MscrmCommon.EventConstants.Change,this.updateCallback);this.rating.dispose()}$(this.container).empty()};Object.defineProperty(StarRatingControl.prototype,"maxStars",{"get":function(){return this.rating.maxRating},enumerable:true,configurable:true});StarRatingControl.prototype.setDisabledMode=function(isDisabled){$(this.rating.element).toggleClass(StarRatingControl.disabledClass,isDisabled)};StarRatingControl.prototype.setReadMode=function(isReadMode){$(this.rating.element).toggleClass(MscrmCommon.ThemingHelper.ReadModeClassName,isReadMode)};StarRatingControl.buildTheme=function(theming){return MscrmCommon.ControlUtils.String.Format("\t\t\t\t.win-user.win-full { color:{0} !important; } \n \t\t\t\t.win-tentative.win-full { color:{0} !important; }",MscrmCommon.ThemingHelper.getProcessControlColor(theming))};StarRatingControl.prototype.updateValues=function(context){var max=parseInt(context.parameters.max.raw,10),maxRating=this.normalizeNoStarsValue(max);if(maxRating!==this.rating.maxRating)this.rating.maxRating=maxRating;var userRating=this.normalizeUserRatingValue(context.parameters.value.raw);if(userRating!==this.rating.userRating)this.rating.userRating=userRating};StarRatingControl.prototype.normalizeUserRatingValue=function(value){var min=0,max=StarRatingControl.MaxNumberOfStars;return MscrmCommon.ControlUtils.Object.isNullOrUndefined(value)?min:this.clampValue(value,min,max)};StarRatingControl.prototype.normalizeNoStarsValue=function(value){var min=StarRatingControl.MinNumberOfStars,max=StarRatingControl.MaxNumberOfStars;return MscrmCommon.ControlUtils.Object.isNullOrUndefined(value)?max:this.clampValue(value,min,max)};StarRatingControl.prototype.clampValue=function(value,min,max){return value<=min?min:value>=max?max:value};StarRatingControl.prototype.throwIfPropertyBagParametersNotValid=function(context){MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.parameters.value)&&ExceptionHandler.throwException(MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"value"));MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.parameters.max)&&ExceptionHandler.throwException(MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"max"));parseInt(context.parameters.max.raw,10)===NaN&&ExceptionHandler.throwException(MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"max.raw"))};StarRatingControl.disabledClass="inactive";StarRatingControl.MaxNumberOfStars=5;StarRatingControl.MinNumberOfStars=1;return StarRatingControl}(MscrmCommon.FieldControlBase);Rating.StarRatingControl=StarRatingControl})(Rating=MscrmControls.Rating||(MscrmControls.Rating={}))})(MscrmControls||(MscrmControls={}))