/** @license Copyright (c) Microsoft Corporation. All rights reserved. */
var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}__.prototype=b.prototype;d.prototype=new __},MscrmControls;(function(MscrmControls){var OptionSet;(function(OptionSet){"use strict";var OptionSetControl=function(_super){__extends(OptionSetControl,_super);function OptionSetControl(){_super.call(this);this.controlId=0;this.optionSetElement=null;this.currentOptions=null;this.defaultValue=-1;this.notificationIsCleared=false;this.controlId=OptionSetControl.uniqueId++}OptionSetControl.prototype.initCore=function(context){this.processPropertyBagValues(context);context.theming.disableUiTransitions();this.createControl(context)};OptionSetControl.prototype.updateCore=function(context){this.processPropertyBagValues(context);if(this.newOptionsAreDifferent(context)){this.destroyControl();this.createControl(context)}else{if(this.isControlEmpty)return;this.setState(context.mode.isControlDisabled?MscrmControls.Common.ControlState.Disabled:MscrmControls.Common.ControlState.Enabled);this.highlightValue(context.parameters.value)}};OptionSetControl.prototype.getOutputsCore=function(){return {value:this.getSelectedValue()}};OptionSetControl.prototype.renderReadMode=function(context){_super.prototype.renderReadMode.call(this,context);if(this.isControlEmpty)return;context.mode.isControlDisabled&&this.setState(MscrmControls.Common.ControlState.Disabled)};OptionSetControl.prototype.renderEditMode=function(context){this.shouldNotifyOutputChanged=true};OptionSetControl.prototype.destroyCore=function(){if(!this.isControlInitialized)return;this.destroyControl()};OptionSetControl.prototype.isControlEnabled=function(context){return !context.mode.isControlDisabled};OptionSetControl.prototype.destroyControl=function(){if(!this.isControlEmpty){this.unregisterChangeEventHandlers();this.optionSetElement.controlgroup(MscrmCommon.MethodConstants.Destroy);$(MscrmCommon.ControlUtils.String.Format("[name='{0}']",this.radioChoiceElementName)).checkboxradio(MscrmCommon.MethodConstants.Destroy);this.optionSetElement.empty();this.optionSetElement=null;this.stringResourceProvider=null;this.radioChoiceElementName=null}$(this.container).empty()};OptionSetControl.prototype.createControl=function(context){this.cacheControlOptions(context.parameters.value);this.stringResourceProvider=context.resources.getString;if(this.isControlEmpty&&this.currentOptions.length===0){this.showNoOptionAvailableMessage(this.container,context.theming);return}this.createOptionSetElement(this.container);this.createOptions(context);this.setState(context.mode.isControlDisabled?MscrmControls.Common.ControlState.Disabled:MscrmControls.Common.ControlState.Enabled);this.highlightValue(context.parameters.value);this.registerNotifyOutputChanged();this.registerValueChanged();this.registerValueSelectedClearNotification();this.setCustomStyles(OptionSetControl.CustomWrapperClass);this.buildAndInjectCustomThemeClass(context.theming)};OptionSetControl.prototype.showNoOptionAvailableMessage=function(container,theming){var noOptionsMessage=this.stringResourceProvider(OptionSetControl.NoOptionsSpecifiedKey),noOptionHtmlFormat="<div class={0}>{1}</div>",noOptionDivElement=$(MscrmCommon.ControlUtils.String.Format(noOptionHtmlFormat,OptionSetControl.CustomWrapperErrorClass,noOptionsMessage));$(this.container).append(noOptionDivElement);this.buildAndInjectCustomErrorClass(theming)};OptionSetControl.prototype.createOptionSetElement=function(container){var optionSetHtmlFormat="<fieldset class='{0}' data-role='controlgroup' data-type='horizontal'></fieldset>";this.optionSetElement=$(MscrmCommon.ControlUtils.String.Format(optionSetHtmlFormat,MscrmCommon.CommonControl.ClassName));$(this.container).append(this.optionSetElement)};OptionSetControl.prototype.createOptions=function(context){var _this=this;this.radioChoiceElementName=MscrmCommon.ControlUtils.String.Format(OptionSetControl.RadioChoiceElementNameFormat,this.controlId);(new MscrmCommon.ArrayQuery(context.parameters.value.attributes.options)).each(function(item){var radioChoiceElementId=MscrmCommon.ControlUtils.String.Format(OptionSetControl.RadioChoiceElementIdFormat,_this.controlId,item.Value),radioItem=$("<input>").attr({type:"radio",name:_this.radioChoiceElementName,id:radioChoiceElementId}),labelItem=$("<label>"),optionItem=labelItem.append(radioItem,item.Label);_this.optionSetElement.append(optionItem);radioItem.checkboxradio()});this.optionSetElement.controlgroup()};OptionSetControl.prototype.registerNotifyOutputChanged=function(){var _this=this;this.optionSetElement.on(MscrmCommon.EventConstants.Change,function(){_this.notifyEnabledControlOutputChanged.apply(_this)})};OptionSetControl.prototype.registerValueChanged=function(){var _this=this;this.optionSetElement.on(MscrmCommon.EventConstants.Change,function(event,data){if(_this.isChangeEventTriggeredInternally(data))return;var selectedValue=_this.getSelectedValue();if(OptionSetControl.isSameOptionSelectedAgain($(event.target))&&!_this.hasDefaultValue()&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(selectedValue)){_this.deselectOption(selectedValue);_this.optionSetElement.controlgroup(MscrmCommon.MethodConstants.Refresh)}})};OptionSetControl.prototype.registerValueSelectedClearNotification=function(){var _this=this;this.optionSetElement.on(MscrmCommon.EventConstants.Change,function(event,data){if(_this.isChangeEventTriggeredInternally(data))return;_this.notificationHandler.clear(OptionSetControl.MoreThanThreeOptionsSpecifiedKey);_this.notificationIsCleared=true})};OptionSetControl.prototype.isChangeEventTriggeredInternally=function(data){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(data)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(data.changeEventIsTriggeredInternally)&&data.changeEventIsTriggeredInternally};OptionSetControl.prototype.deselectOption=function(value){this.getOptionDomElement(value).prop(MscrmCommon.AttributeConstants.Checked,false)};OptionSetControl.prototype.unregisterChangeEventHandlers=function(){this.optionSetElement.off(MscrmCommon.EventConstants.Change)};OptionSetControl.prototype.highlightValue=function(value){var _this=this;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(value.raw)||value.raw===OptionSetControl.UnassignedDefaultValue||!OptionSetControl.isValueContainedInOptions(this.currentOptions,value.raw)){(new MscrmCommon.ArrayQuery(this.currentOptions)).each(function(option){_this.getOptionDomElement(option.Value).prop(MscrmCommon.AttributeConstants.Checked,false)});this.getOptionDomElement(this.currentOptions[0].Value).trigger(MscrmCommon.EventConstants.Change,OptionSetControl.changeEventIsTriggeredInternally())}else{this.getOptionDomElement(value.raw).prop(MscrmCommon.AttributeConstants.Checked,true);this.getOptionDomElement(this.currentOptions[0].Value).trigger(MscrmCommon.EventConstants.Change,OptionSetControl.changeEventIsTriggeredInternally())}this.optionSetElement.controlgroup(MscrmCommon.MethodConstants.Refresh)};OptionSetControl.changeEventIsTriggeredInternally=function(){return [{changeEventIsTriggeredInternally:true}]};OptionSetControl.prototype.setState=function(state){var _this=this,methodConstant=state===MscrmControls.Common.ControlState.Disabled?MscrmCommon.MethodConstants.Disable:MscrmCommon.MethodConstants.Enable;(new MscrmCommon.ArrayQuery(this.currentOptions)).each(function(option){_this.getOptionDomElement(option.Value).checkboxradio(methodConstant)});this.optionSetElement.controlgroup(methodConstant)};OptionSetControl.prototype.isControlDisabled=function(){var options=this.optionSetElement.controlgroup(MscrmCommon.MethodConstants.Option);return options[MscrmCommon.AttributeConstants.Disabled]};Object.defineProperty(OptionSetControl.prototype,"isControlEmpty",{"get":function(){return MscrmCommon.ControlUtils.Object.isNullOrUndefined(this.optionSetElement)},enumerable:true,configurable:true});OptionSetControl.prototype.processPropertyBagValues=function(context){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.parameters.value))throw MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"value");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.parameters.value.attributes.options))throw MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"value.attributes.options");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.parameters.value.attributes.defaultValue))throw MscrmCommon.ControlUtils.String.Format(MscrmCommon.CommonControl.InvalidDataBagKeyFormat,"value.attributes.defaultValue");if(!OptionSetControl.checkDefaultValueIsValid(context))throw MscrmCommon.ControlUtils.String.Format(OptionSetControl.defaultValueIsNotValid,context.parameters.value.attributes.defaultValue);if(!OptionSetControl.checkRawValueIsValid(context))throw MscrmCommon.ControlUtils.String.Format(OptionSetControl.rawValueIsNotValid,context.parameters.value.raw);if(context.parameters.value.attributes.options.length>OptionSetControl.maxNumberOfOptions){if(!this.notificationIsCleared){var message=context.resources.getString(OptionSetControl.MoreThanThreeOptionsSpecifiedKey);this.notificationHandler.notify(message,OptionSetControl.MoreThanThreeOptionsSpecifiedKey)}context.parameters.value.attributes.options.splice(OptionSetControl.maxNumberOfOptions)}};OptionSetControl.checkDefaultValueIsValid=function(context){if(context.parameters.value.attributes.defaultValue===OptionSetControl.UnassignedDefaultValue)return true;return this.isValueContainedInOptions(context.parameters.value.attributes.options,context.parameters.value.attributes.defaultValue)};OptionSetControl.checkRawValueIsValid=function(context){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.parameters.value.raw))return true;else if(context.parameters.value.attributes.options.length===0){context.parameters.value.raw=null;return true}return this.isValueContainedInOptions(context.parameters.value.attributes.options,context.parameters.value.raw)};OptionSetControl.isValueContainedInOptions=function(options,value){for(var index=0;index<options.length;index++)if(options[index].Value===value)return true;return false};OptionSetControl.prototype.newOptionsAreDifferent=function(newDataBag){var oldOptions=this.currentOptions;this.currentOptions=newDataBag.parameters.value.attributes.options;if(oldOptions==null)return true;if(oldOptions.length!==this.currentOptions.length)return true;for(var index=0;index<this.currentOptions.length;index++)if(oldOptions[index].Label!==this.currentOptions[index].Label||oldOptions[index].Value!==this.currentOptions[index].Value)return true;return false};OptionSetControl.prototype.cacheControlOptions=function(value){this.currentOptions=value.attributes.options;this.defaultValue=value.attributes.defaultValue};OptionSetControl.prototype.getSelectedValue=function(){for(var index=0;index<this.currentOptions.length;index++){var option=this.currentOptions[index];if(this.getOptionDomElement(option.Value).prop(MscrmCommon.AttributeConstants.Checked)===true)return option.Value}return null};OptionSetControl.prototype.getOptionDomElement=function(optionValue){var selectedRadioChoiceDomElement=MscrmCommon.ControlUtils.String.Format(OptionSetControl.RadioChoiceElementIdFormat,this.controlId,optionValue);return $("#"+selectedRadioChoiceDomElement)};OptionSetControl.prototype.hasDefaultValue=function(){if(this.defaultValue!==OptionSetControl.UnassignedDefaultValue)return true;return false};OptionSetControl.isSameOptionSelectedAgain=function(target){return target.parent().find("label").hasClass(OptionSetControl.RadioButtonSelectedClass)};OptionSetControl.prototype.setCustomStyles=function(customWrapperClass){this.optionSetElement.toggleClass(customWrapperClass,true)};OptionSetControl.prototype.removeCustomStyles=function(customWrapperClass){this.optionSetElement.toggleClass(customWrapperClass,false)};OptionSetControl.prototype.buildAndInjectCustomThemeClass=function(theming){var processControlColor=MscrmCommon.ThemingHelper.getProcessControlColor(theming),processNonSelectedColor=MscrmCommon.ThemingHelper.getProcessNonSelectedColor(theming),fontFamily=MscrmCommon.ThemingHelper.getFontFamily(theming),fontSize=MscrmCommon.ThemingHelper.getFontSize(theming),styleFormat=".crm-jqm-optionset.ui-controlgroup-horizontal .ui-radio-on {\t\t\t\t\tbackground-color: {0};\t\t\t\t}\t\t\t\t.crm-jqm-optionset.ui-controlgroup-horizontal .ui-radio-off {\t\t\t\t\tbackground-color: {1};\t\t\t\t}\t\t\t\t.crm-jqm-optionset.ui-controlgroup-horizontal .ui-btn {\t\t\t\t\tfont-family: {2};\t\t\t\t\tfont-size: {3};\t\t\t\t}",widthClass=this.buildAndSetWidthClass(),customThemeStyle=MscrmCommon.ControlUtils.String.Format(styleFormat,processControlColor,processNonSelectedColor,fontFamily,fontSize)+widthClass;MscrmCommon.ThemingHelper.injectStyle(this.container,customThemeStyle)};OptionSetControl.prototype.buildAndSetWidthClass=function(){var numberOfOptions=this.currentOptions.length,buttonWidth=100/numberOfOptions,widthClassName=MscrmCommon.ControlUtils.String.Format(OptionSetControl.OptionSetButtonWidthClass,numberOfOptions),buttonWidthFormat=".{0} { width: {1}%; }",widthClass=MscrmCommon.ControlUtils.String.Format(buttonWidthFormat,widthClassName,buttonWidth),controlGroup=this.optionSetElement.children(),options=controlGroup.children();options.toggleClass(widthClassName,true);return widthClass};OptionSetControl.prototype.buildAndInjectCustomErrorClass=function(theming){var fontfamily=MscrmCommon.ThemingHelper.getFontFamily(theming),fontsize=MscrmCommon.ThemingHelper.getFontSize(theming),redColor="#ff0000",errorThemeStyleFormat=".crm-jqm-optionset-error {\t\t\t\t\tfont-family: {0};\t\t\t\t\tfont-size: {1};\t\t\t\t\tcolor: {2};\t\t\t\t}",errorThemeStyle=MscrmCommon.ControlUtils.String.Format(errorThemeStyleFormat,fontfamily,fontsize,redColor);MscrmCommon.ThemingHelper.injectStyle(this.container,errorThemeStyle)};OptionSetControl.RadioButtonSelectedClass="ui-radio-on";OptionSetControl.CustomWrapperClass="crm-jqm-optionset";OptionSetControl.CustomWrapperErrorClass="crm-jqm-optionset-error";OptionSetControl.DisabledControlGroupClass="mobile-controlgroup-disabled";OptionSetControl.DisabledControlGroupSelector="."+OptionSetControl.DisabledControlGroupClass;OptionSetControl.DisabledUiStateClass="ui-state-disabled";OptionSetControl.DisabledUiStateSelector="."+OptionSetControl.DisabledUiStateClass;OptionSetControl.DisabledCheckboxradioClass="mobile-checkboxradio-disabled";OptionSetControl.DisabledCheckboxradioSelector="."+OptionSetControl.DisabledCheckboxradioClass;OptionSetControl.OptionSetButtonWidthClass="crm-jqm-optionSet{0}ButtonWidth";OptionSetControl.NoOptionsSpecifiedKey="OptionSet_NoOptionsSpecified_Error";OptionSetControl.MoreThanThreeOptionsSpecifiedKey="OptionSet_MoreThanThreeOptionsSpecified_Error";OptionSetControl.UnassignedDefaultValue=-1;OptionSetControl.RadioChoiceElementNameFormat="radio-choice-name-{0}";OptionSetControl.RadioChoiceElementIdFormat="radio-choice-id-{0}-{1}";OptionSetControl.minNumberOfOptions=2;OptionSetControl.maxNumberOfOptions=3;OptionSetControl.defaultValueIsNotValid="Specified default value of {0}, is not a valid option value.";OptionSetControl.rawValueIsNotValid="Specified raw value of {0}, is not a valid option value.";OptionSetControl.uniqueId=0;return OptionSetControl}(MscrmCommon.FieldControlBase);OptionSet.OptionSetControl=OptionSetControl})(OptionSet=MscrmControls.OptionSet||(MscrmControls.OptionSet={}))})(MscrmControls||(MscrmControls={}))